<?xml version="1.0" encoding="utf-8"?>
<RuleEngine>
  <Rules>
    <Rule id="L10" DestinationSavePath="//H" ProcessAsGroup="False" desc="Rules For L10 Header Record">
      <Mappings>
        <Mapping id="Mapping1">
          <Source>number(@store_num)</Source>
          <Destination>//H/@Store_no</Destination>
        </Mapping>
        <Mapping id="Mapping2">
          <Source>number(@trans_num)</Source>
          <Destination>//H/@Transaction_no</Destination>
        </Mapping>
        <Mapping id="Mapping3">
          <Source>number(@cashier)</Source>
          <Destination>//H/@Cashier_no</Destination>
        </Mapping>
        <Mapping id="Mapping4" format="{0:MM/dd/yyyy HH:mm:00}" type="System.DateTime">
          <Source>string(@trans_date)</Source>
          <Destination>//H/@Entry_date_time</Destination>
        </Mapping>
      </Mappings>
      <Conditions>
        <Condition id="1" name="Condition1">
          <Expression>@reg_num='0'</Expression>
          <Destination>//H/@Register_no</Destination>
          <True isExpression="false" UseDefault="True" ContinueProcessing="True"></True>
          <False isExpression="true" ExpressionSource="SourceFile" UseDefault="false" ContinueProcessing="True">number(@reg_num)</False>
        </Condition>
        <Condition id="2" name="Condition2">
          <Expression>(floor(number(./../L10/@qualify) div 128) mod 2 > 0) or (floor(number(./../L10/@qualify) div 1) mod 2 > 0) or (floor(number(./../L10/@qualify) div 16) mod 2 > 0)  </Expression>
          <Destination>//H/@Tax_override_flag</Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True">1</True>
        </Condition>
        <Condition id="3" name="Condition3">
          <Expression>@flgs_L10PVOID='1'</Expression>
          <Destination>//H/@Transaction_void_flag</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">1</True>
        </Condition>
        <Condition id="4" name="Condition4">
          <Expression>@flgs_L10AVOID='1'</Expression>
          <Destination>//H/@Transaction_void_flag</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">2</True>
        </Condition>
        <Condition id="5" name="Condition5">
          <Expression>@flgs_L10STRAN='1'</Expression>
          <Destination>//H/@Transaction_void_flag</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">2</True>
        </Condition>
        <Condition id="6" name="Condition6">
          <Expression>(@flgs_L10ADMIN ='0' and (@type = '3' or @type = '4' or @type = '0' or @type = '1' or @type = '2'))</Expression>
          <Destination>//H/@Transaction_category</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">1</True>
        </Condition>
        <Condition id="6" name="Condition6">
          <Expression>(@flgs_L10ADMIN ='' and (number(@type) = '3' or number(@type) = '4' or number(@type) = '0' or number(@type) = '1' or number(@type) = '2'))</Expression>
          <Destination>//H/@Transaction_category</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">1</True>
        </Condition>
        <Condition id="7" name="Condition7">
          <Expression>@flgs_L10ADMIN ='1' and (@type = '3' or @type = '9' or @type = '105' or @type = '148' or @type = '41' or @type = '73' or @type = '89')</Expression>
          <Destination>//H/@Transaction_category</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">1</True>
        </Condition>
        <Condition id="8" name="Condition8">
          <Expression>@flgs_L10ADMIN ='1' and @type = '1'</Expression>
          <Destination>//H/@Transaction_category</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine1">7</True>
        </Condition>
        <Condition id="9" name="Condition9">
          <Expression>@flgs_L10ADMIN ='1' and @type = '2'</Expression>
          <Destination>//H/@Transaction_category</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine2" ContinueTransaction="False">2</True>
        </Condition>
        <Condition id="10" name="Condition10">
          <Expression>@flgs_L10ADMIN ='1' and @type = '136' and @flgs_L10AVOID = '1'</Expression>
          <Destination>//H/@Transaction_void_flag</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">2</True>
        </Condition>
        <Condition id="11" name="Condition11">
          <Expression>@flgs_L10ADMIN ='1' and @type = '136' and @flgs_L10AVOID != '1'</Expression>
          <Destination>//H/@Transaction_void_flag</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">1</True>
        </Condition>
        <Condition id="12" name="Condition12">
          <Expression>@flgs_L10ADMIN ='1' and @type = '136'</Expression>
          <Destination>//H/@Transaction_category</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">1</True>
        </Condition>
        <Condition id="13" name="Condition13">
          <Expression>(@flgs_L10ADMIN ='1' and (@type = '114' or @type = '0' or @type = '57' or @type = '83' or @type = '81' or @type = '82' or @type = '8' or @type = '48' or @type = '49' or @type = '96'))</Expression>
          <Destination>//H/@Transaction_category</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">2</True>
        </Condition>
        <Condition id="14" name="Condition14">
          <Expression>@flgs_L10ADMIN ='1' and @type = '153'</Expression>
          <Destination>//H/@Transaction_category</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">2</True>
        </Condition>
        <Condition id="15" name="Condition15">
          <Expression>@flgs_L10ADMIN ='1' and @type = '153' and @reg_num='0'</Expression>
          <Destination>//H/@Closeout_flag</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">2</True>
        </Condition>
        <Condition id="16" name="Condition16">
          <Expression>@flgs_L10ADMIN ='1' and (@type = '86' or @type='12' or @type='4')</Expression>
          <Destination>//H/@Transaction_category</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">2</True>
        </Condition>
        <Condition id="17" name="Condition17">
          <Expression>@flgs_L10ADMIN ='1' and @type = '86'</Expression>
          <Destination>//H/@Bank_deposit_declaration_flag</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">1</True>
        </Condition>
        <Condition id="19" name="Condition19">
          <Expression>@flgs_L10ADMIN ='1' and (@type = '51' or @type = '50')</Expression>
          <Destination>//H/@Transaction_category</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">8</True>
        </Condition>
        <Condition id="20" name="Condition20">
          <Expression>@flgs_L10ADMIN ='1' and (@type='50' or @type = '51')</Expression>
          <Destination>//H/@Transaction_remark</Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True">Not used REENTRY MODE</True>
        </Condition>
        <Condition id="21" name="Condition21">
          <Expression>@flgs_L10ADMIN ='1' and @type='51'</Expression>
          <Destination>//H/@Transaction_remark</Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True">Not used MDSE TRANSFERED</True>
        </Condition>
        <Condition id="22" name="Condition22">
          <Expression>@flgs_L10ADMIN ='1' and (@type = '95' or @type = '65' or @type = '66' or @type = '67' or @type = '101' or @type = '112' or @type = '145' or @type = '146')</Expression>
          <Destination>//H/@Transaction_category</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine5" ContinueTransaction="False">8</True>
        </Condition>
        <Condition id="23" name="Condition23">
          <Expression>@flgs_L10ADMIN ='1' and @type='65'</Expression>
          <Destination>//H/@Transaction_remark</Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True">Not used MDSE RECEIVED</True>
        </Condition>
        <Condition id="24" name="Condition24">
          <Expression>@flgs_L10ADMIN ='1' and @type='66'</Expression>
          <Destination>//H/@Transaction_remark</Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True">Not used MDSE TRANSFERED</True>
        </Condition>
        <Condition id="25" name="Condition25">
          <Expression>@flgs_L10ADMIN ='1' and @type='67'</Expression>
          <Destination>//H/@Transaction_remark</Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True">Not used MDSE PHYSICAL COUNT</True>
        </Condition>
        <Condition id="26" name="Condition26">
          <Expression>@flgs_L10ADMIN ='1' and @type='101'</Expression>
          <Destination>//H/@Transaction_remark</Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True">Not used H/R MAINT</True>
        </Condition>
        <Condition id="27" name="Condition27">
          <Expression>@flgs_L10ADMIN ='1' and @type='112'</Expression>
          <Destination>//H/@Transaction_remark</Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True">Not used SHIPMENT RECEIVING</True>
        </Condition>
        <Condition id="28" name="Condition28">
          <Expression>@flgs_L10ADMIN ='1' and @type='145'</Expression>
          <Destination>//H/@Transaction_remark</Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True">Not used SHIPMENT RECEIVING</True>
        </Condition>
        <Condition id="29" name="Condition29">
          <Expression>@flgs_L10ADMIN ='1' and @type='146'</Expression>
          <Destination>//H/@Transaction_remark</Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True">Not used SPECIAL INVENTORY</True>
        </Condition>
        <Condition id="30" name="Condition30">
          <Expression>@flgs_L10ADMIN ='1' and @type='95'</Expression>
          <Destination>//H/@Transaction_remark</Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True">Not used SIRIS REQUEST</True>
        </Condition>
        <Condition id="31" name="Condition31">
          <Expression>@flgs_L10ADMIN ='1' and @type = '117'</Expression>
          <Destination>//H/@Transaction_category</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine3">8</True>
        </Condition>
        <Condition id="32" name="Condition32">
          <Expression>@flgs_L10ADMIN ='1' and @type='117'</Expression>
          <Destination>//H/@Transaction_remark</Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True">Not used WIZ MAIL</True>
        </Condition>
        <Condition id="33" name="Condition33">
          <Expression>@flgs_L10ADMIN ='1' and (@type = '144' or @type = '5' or @type = '6')</Expression>
          <Destination>//H/@Transaction_category</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">15</True>
        </Condition>
        <Condition id="34" name="Condition34">
          <!--<Expression>@flgs_L10REENT ='1' and //@record_type = '10'</Expression>-->
          <Expression>@flgs_L10REENT ='1'</Expression>
          <Destination>//H/@Transaction_category</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine3">8</True>
        </Condition>
        <Condition id="35" name="Condition35">
          <!--<Expression>@flgs_L10REENT ='1' and //@record_type = '10'</Expression>-->
          <Expression>@flgs_L10REENT ='1'</Expression>
          <Destination>//H/@Transaction_remark</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">Not used REENTRY MODE</True>
        </Condition>
        <Condition id="37" name="Condition37">
          <Expression>@flgs_L10ADMIN ='1' and @type = '4'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="GhostTransaction"></True>
        </Condition>
        <Condition id="36" name="Condition36">
          <!--Catch all.  If we come across a type that isn't used we have to add a line item-->
          <Expression>@flgs_L10ADMIN ='1' and (@type != '144' and @type != '4' and @type != '5' and @type != '6' and @type != '12' and @type != '117' and @type != '95' and @type != '65' and @type != '66' and @type != '67' and @type != '101' and @type != '112' and @type != '145' and @type != '146' and @type != '51' and @type != '50' and @type != '86' and @type != '153' and @type != '114' and @type != '0' and @type != '57' and @type != '83' and @type != '81' and @type != '82' and @type != '8' and @type != '48' and @type != '49' and @type != '96' and @type != '136' and @type != '1' and @type != '2' and @type != '3' and @type != '9' and @type != '105' and @type != '148' and @type != '41' and @type != '73' and @type != '89')</Expression>
          <Destination>//H/@Transaction_category</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine5" ContinueTransaction="True">8</True>
        </Condition>
        <Condition id="36" name="Condition36">
          <!--Catch all.  If we come across a type that isn't used we have to add a line item-->
          <Expression>@flgs_L10ADMIN ='1' and (@type != '144' and @type != '4' and @type != '5' and @type != '6' and @type != '12' and @type != '117' and @type != '95' and @type != '65' and @type != '66' and @type != '67' and @type != '101' and @type != '112' and @type != '145' and @type != '146' and @type != '51' and @type != '50' and @type != '86' and @type != '153' and @type != '114' and @type != '0' and @type != '57' and @type != '83' and @type != '81' and @type != '82' and @type != '8' and @type != '48' and @type != '49' and @type != '96' and @type != '136' and @type != '1' and @type != '2' and @type != '3' and @type != '9' and @type != '105' and @type != '148' and @type != '41' and @type != '73' and @type != '89')</Expression>
          <Destination>//H/@Transaction_remark</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" ContinueTransaction="False">Not Used</True>
        </Condition>

        <Condition id="37" name="Condition37">
          <!--<Expression>(@flgs_L10STRAN ='1' or @flgs_L10AVOID ='1') and @record_type = '12'</Expression>-->
          <Expression>(@flgs_L10STRAN ='1' or @flgs_L10AVOID ='1') and count(following-sibling::L12) = 0</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine4"></True>
        </Condition>
        <Condition id="38" name="Condition38">
          <Expression>count(following-sibling::L12) > 0 </Expression>
          <Destination>>//H/@Purchasing_employee_no</Destination>
          <True isExpression="true" UseDefault="false" ContinueProcessing="True" >following-sibling::L12[1]/@employee</True>
        </Condition>
        <Condition id="39" name="Condition39">
          <Expression>string(./../L99/@salesper) != '' and string(./../L99/@salesper) != '0'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine6"></True>
        </Condition>
        <Condition id="40" name="Condition40">
          <Expression>string(./../L99/@orig_sale) != '' and string(./../L99/@orig_sale) != '0'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine7"></True>
        </Condition>
      </Conditions>
      <!--Actions Get Performed after Rule Processing in the order they were requested-->
      <Actions>
        <Action>
          <CreateLineItem id="NewLine1" ItemToCreate="//L">
            <Attribute id="Line_object">1200</Attribute>
            <Attribute id="Line_action">31</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine2" ItemToCreate="//L">
            <Attribute id="Line_object">1200</Attribute>
            <Attribute id="Line_action">52</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine3" ItemToCreate="//L">
            <Attribute id="Line_object">1408</Attribute>
            <Attribute id="Line_action">38</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine4" ItemToCreate="//L">
            <Attribute id="Line_object">1101</Attribute>
            <Attribute id="Line_action">35</Attribute>
            <Attribute id="Line_void_flag">1</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine5" ItemToCreate="//L">
            <Attribute id="Line_object">1407</Attribute>
            <Attribute id="Line_action">38</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine6" ItemToCreate="//N">
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(./../L99/@salesper)</Attribute>
            <Attribute id="Line_note_type">127</Attribute>
            <Attribute id="Line_id" useIdentity="false">0</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine7" ItemToCreate="//N">
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(./../L99/@orig_sale)</Attribute>
            <Attribute id="Line_note_type">128</Attribute>
            <Attribute id="Line_id" useIdentity="false">0</Attribute>
          </CreateLineItem>
          <CreateLineItem id="GhostTransaction" ItemToCreate="//L">
            <Attribute id="Line_object">1230</Attribute>
            <Attribute id="Line_action">38</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
        </Action>
      </Actions>
    </Rule>
    <Rule id="L12" DestinationSavePath="//L" ProcessAsGroup="False" desc="Rules For L12 Record">
      <Mappings></Mappings>
      <Conditions>
        <Condition id="1" name="Condition1">
          <Expression>./../L10/@type = '96'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine1"></True>
        </Condition>
        <Condition id="1a" name="Condition1">
          <Expression>./../L10/@type = '96'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine1a"></True>
        </Condition>
        <Condition id="2" name="Condition2">
          <Expression>./../L10/@type = '50'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine2"></True>
        </Condition>
        <Condition id="3" name="Condition3">
          <Expression>./../L10/@type = '51'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine2"></True>
        </Condition>
        <Condition id="4" name="Condition4">
          <Expression>./../L10/@type = '114'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine7"></True>
        </Condition>
        <Condition id="5" name="Condition5">
          <Expression>./../L10/@type = '5'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine3"></True>
        </Condition>
        <Condition id="6" name="Condition6">
          <Expression>./../L10/@type = '6'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine4"></True>
        </Condition>
        <Condition id="7" name="Condition7">
          <Expression>./../L10/@type = '48'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine5"></True>
        </Condition>
        <Condition id="8" name="Condition8">
          <Expression>./../L10/@type = '49'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine6"></True>
        </Condition>
        <Condition id="9" name="Condition9">
          <Expression>./../L10/@type = '8'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine8"></True>
        </Condition>
        <Condition id="10" name="Condition10">
          <Expression>./../L10/@type = '8'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine9"></True>
        </Condition>
        <Condition id="11" name="Condition11">
          <Expression>./../L10/@type = '136'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine10"></True>
        </Condition>
        <Condition id="12" name="Condition12">
          <Expression>./../L10/@type = '136'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine11"></True>
        </Condition>
        <Condition id="13" name="Condition13">
          <Expression>@type = '0' and (./../L10/@flgs_L10AVOID = '1' or ./../L10/flgs_L10STRAN = '1' )</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine12"></True>
        </Condition>
        <Condition id="14" name="Condition14">
          <Expression>@type = '1' and @reason = '1'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine13"></True>
        </Condition>
        <Condition id="15" name="Condition15">
          <Expression>@type = '1' and @reason = '2'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine14"></True>
        </Condition>
        <Condition id="16" name="Condition16">
          <Expression>@type = '1' and @reason = '3'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine15"></True>
        </Condition>
        <Condition id="17" name="Condition17">
          <Expression>@type = '1' and @reason = '4'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine16">
          </True>
        </Condition>
        <Condition id="18" name="Condition18">
          <Expression>@type = '1' and @reason = '5'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine17">
          </True>
        </Condition>
        <Condition id="19" name="Condition19">
          <Expression>@type = '1' and @reason = '6'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine18">
          </True>
        </Condition>
        <Condition id="20" name="Condition20">
          <Expression>@type = '1' and @reason = '7'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine19">
          </True>
        </Condition>
        <Condition id="21" name="Condition21">
          <Expression>@type = '1' and @reason = '8'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine20">
          </True>
        </Condition>
        <Condition id="22" name="Condition22">
          <Expression>@type = '1' and @reason = '9'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine21">
          </True>
        </Condition>
        <Condition id="23" name="Condition23">
          <Expression>@type = '1' and @reason = '10'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine22">
          </True>
        </Condition>
        <Condition id="24" name="Condition24">
          <Expression>@type = '1' and @reason = '11'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine23">
          </True>
        </Condition>
        <Condition id="25" name="Condition25">
          <Expression>@type = '1' and @reason = '12'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine24">
          </True>
        </Condition>
        <Condition id="26" name="Condition26">
          <Expression>@type = '1' and @reason = '13'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine25">
          </True>
        </Condition>
        <Condition id="27" name="Condition27">
          <Expression>@type = '1' and @reason = '14'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine26">
          </True>
        </Condition>
        <Condition id="41" name="Condition41">
          <Expression>@type = '1' and @reason = '15'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine8A">
          </True>
        </Condition>
        <Condition id="28" name="Condition28">
          <Expression>@type = '2' and @reason = '1'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine27">
          </True>
        </Condition>
        <Condition id="29" name="Condition29">
          <Expression>@type = '2' and @reason = '2'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine28">
          </True>
        </Condition>
        <Condition id="30" name="Condition30">
          <Expression>@type = '2' and @reason = '3'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine29">
          </True>
        </Condition>
        <Condition id="31" name="Condition31">
          <Expression>@type = '2' and @reason = '4'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine30">
          </True>
        </Condition>
        <Condition id="32" name="Condition32">
          <Expression>@type = '2' and @reason = '5'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine31">
          </True>
        </Condition>
        <Condition id="33" name="Condition33">
          <Expression>@type = '2' and @reason = '6'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine32">
          </True>
        </Condition>
        <Condition id="34" name="Condition34">
          <Expression>@type = '2' and @reason = '7'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine33">
          </True>
        </Condition>
        <Condition id="35" name="Condition35">
          <Expression>@type = '2' and @reason = '8'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine34">
          </True>
        </Condition>
        <Condition id="36" name="Condition36">
          <Expression>@type = '2' and @reason = '9'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine35" />
        </Condition>
        <Condition id="37" name="Condition37">
          <Expression>@type = '2' and @reason = '10'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine40" />
        </Condition>
        <Condition id="36a" name="Cash In/Cash Out Reason">
          <Expression>(@type = '1' or @type=2) and (number(following-sibling::L70[1]/@field_type) = 32 and string(following-sibling::L70[1]/@field) != '')</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="CashInCashOutReason" />
        </Condition>
        <Condition id="37" name="Condition37">
          <Expression>count(./../L12[@auth_num != '0']) > 0 and (string(@type) = '1' or string(@type) = '2') </Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine36">
          </True>
        </Condition>

        <Condition id="38" name="Condition38">
          <Expression>(@fees != '0' and @name = 'IORDSHIP') and (number(@fees) &gt; 0 and number(@type) != 1)</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine37">
          </True>
        </Condition>
        <Condition id="38A" name="Condition38">
          <Expression>(@fees != '0' and @name = 'IORDSHIP_SHIPTAX') and (number(@fees) &gt; 0 and number(@type) != 1)</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine37A">
          </True>
        </Condition>


        <Condition id="39" name="Condition39">
          <Expression>(@fees != '0' and @name = 'IORDSHIP') and (number(@fees) &lt; 0 and number(@type) = 1)</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine38">
          </True>
        </Condition>
        <!---->
        <Condition id="40" name="Condition40">
          <Expression>@fees != '0' and @name != 'IORDSHIP' and @name != 'IORDSHIP_SHIPTAX'</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine39">
          </True>
        </Condition>
      </Conditions>
      <Actions>
        <Action>
          <!-- Admin 60-->
          <CreateLineItem id="NewLine1" ItemToCreate="//L">
            <Attribute id="Line_object">1201</Attribute>
            <Attribute id="Line_action">38</Attribute>
            <Attribute id="Reference_no" isExpression="True" ExpressionSource="SourceFile">string(@employee)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine1a" ItemToCreate="//N">
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(@mgrauth)</Attribute>
            <Attribute id="Line_note_type">51</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <!-- Admin 60-->
          <CreateLineItem id="NewLine2" ItemToCreate="//L">
            <Attribute id="Line_object">1407</Attribute>
            <Attribute id="Line_action">38</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Reference_no" isExpression="True" ExpressionSource="SourceFile">string(@employee)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine3" ItemToCreate="//L">
            <Attribute id="Line_object">1350</Attribute>
            <Attribute id="Line_action">38</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Reference_no" isExpression="True" ExpressionSource="SourceFile">string(@employee)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine4" ItemToCreate="//L">
            <Attribute id="Line_object">1351</Attribute>
            <Attribute id="Line_action">38</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Reference_no" isExpression="True" ExpressionSource="SourceFile">string(@employee)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine5" ItemToCreate="//L">
            <Attribute id="Line_object">1211</Attribute>
            <Attribute id="Line_action">49</Attribute>
            <Attribute id="Line_id" useIdentity="true">
            </Attribute>
            <Attribute id="Reference_no" isExpression="True" ExpressionSource="SourceFile">string(@employee)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine6" ItemToCreate="//L">
            <Attribute id="Line_object">1211</Attribute>
            <Attribute id="Line_action">50</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Reference_no" isExpression="True" ExpressionSource="SourceFile">string(@employee)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine7" ItemToCreate="//L">
            <Attribute id="Line_object">1204</Attribute>
            <Attribute id="Line_action">38</Attribute>
            <Attribute id="Reference_no" isExpression="True" ExpressionSource="SourceFile">string(@auth_num)</Attribute>
            <Attribute id="Line_id" useIdentity="true">
            </Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine8" ItemToCreate="//L">
            <Attribute id="Line_object" isExpression="True" ExpressionSource="SourceFile">number(@document) + 710</Attribute>
            <Attribute id="Line_action">15</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Reference_no" isExpression="True" ExpressionSource="SourceFile">string(@employee)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine8A" ItemToCreate="//L">
            <!--Employee Cash out/ Travel Expense -->
            <Attribute id="Line_object" isExpression="True" ExpressionSource="SourceFile">711</Attribute>
            <Attribute id="Line_action">15</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Reference_no" isExpression="True" ExpressionSource="SourceFile">string(@employee)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine9" ItemToCreate="//N">
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(@auth_num)</Attribute>
            <Attribute id="Line_note_type">41</Attribute>
            <Attribute id="Line_id" useIdentity="true">
            </Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine10" ItemToCreate="//L">
            <Attribute id="Line_object">1100</Attribute>
            <Attribute id="Line_action">35</Attribute>
            <Attribute id="Reference_no" isExpression="True" ExpressionSource="SourceFile">string(@auth_num)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine11" ItemToCreate="//V">
            <Attribute id="Line_id" useIdentity="True"></Attribute>
            <Attribute id="Post_voided_register" isExpression="True" ExpressionSource="SourceFile">string(./../L10/@orig_reg_num)</Attribute>
            <Attribute id="Post_voided_transaction_no" isExpression="True" ExpressionSource="SourceFile">string(./../L10/@orig_trans_num)</Attribute>
            <Attribute id="Post_void_successful_flag">1</Attribute>
            <Attribute id="Post_void_reason_code" isExpression="True" ExpressionSource="SourceFile">string(./../L10/@reason)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine12" ItemToCreate="//L">
            <Attribute id="Line_object">1101</Attribute>
            <Attribute id="Line_action">35</Attribute>
            <Attribute id="Line_void_flag">1</Attribute>
            <Attribute id="Reference_no" isExpression="True" ExpressionSource="SourceFile" format="{0:g}" type="System.Int32">number(@employee)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine13" ItemToCreate="//L">
            <Attribute id="Line_object">701</Attribute>
            <Attribute id="Line_action">15</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine14" ItemToCreate="//L">
            <Attribute id="Line_object">702</Attribute>
            <Attribute id="Line_action">15</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine15" ItemToCreate="//L">
            <Attribute id="Line_object">703</Attribute>
            <Attribute id="Line_action">15</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine16" ItemToCreate="//L">
            <Attribute id="Line_object">729</Attribute>
            <Attribute id="Line_action">15</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine17" ItemToCreate="//L">
            <Attribute id="Line_object">749</Attribute>
            <Attribute id="Line_action">15</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine18" ItemToCreate="//L">
            <Attribute id="Line_object">706</Attribute>
            <Attribute id="Line_action">15</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine19" ItemToCreate="//L">
            <Attribute id="Line_object">707</Attribute>
            <Attribute id="Line_action">15</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine20" ItemToCreate="//L">
            <Attribute id="Line_object">708</Attribute>
            <Attribute id="Line_action">15</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine21" ItemToCreate="//L">
            <Attribute id="Line_object">754</Attribute>
            <Attribute id="Line_action">15</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine22" ItemToCreate="//L">
            <Attribute id="Line_object">752</Attribute>
            <Attribute id="Line_action">15</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine23" ItemToCreate="//L">
            <Attribute id="Line_object">709</Attribute>
            <Attribute id="Line_action">15</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine24" ItemToCreate="//L">
            <Attribute id="Line_object">747</Attribute>
            <Attribute id="Line_action">15</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine25" ItemToCreate="//L">
            <Attribute id="Line_object">732</Attribute>
            <Attribute id="Line_action">15</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine26" ItemToCreate="//L">
            <Attribute id="Line_object">756</Attribute>
            <Attribute id="Line_action">15</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine27" ItemToCreate="//L">
            <Attribute id="Line_object">799</Attribute>
            <Attribute id="Line_action">16</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine28" ItemToCreate="//L">
            <Attribute id="Line_object">798</Attribute>
            <Attribute id="Line_action">16</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine29" ItemToCreate="//L">
            <Attribute id="Line_object">797</Attribute>
            <Attribute id="Line_action">16</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine30" ItemToCreate="//L">
            <Attribute id="Line_object">795</Attribute>
            <Attribute id="Line_action">16</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine31" ItemToCreate="//L">
            <Attribute id="Line_object">749</Attribute>
            <Attribute id="Line_action">16</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine32" ItemToCreate="//L">
            <Attribute id="Line_object">794</Attribute>
            <Attribute id="Line_action">16</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine33" ItemToCreate="//L">
            <Attribute id="Line_object">793</Attribute>
            <Attribute id="Line_action">16</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine34" ItemToCreate="//L">
            <Attribute id="Line_object">792</Attribute>
            <Attribute id="Line_action">16</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine35" ItemToCreate="//L">
            <Attribute id="Line_object">755</Attribute>
            <Attribute id="Line_action">16</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine36" ItemToCreate="//N">
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(./../L12[@auth_num != '0']/@auth_num)</Attribute>
            <Attribute id="Line_note_type">41</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <!--Commented out because this same thing is set to happen on the L30 record for internet orders - added back because fixed the real issue -->
          <CreateLineItem id="NewLine37" ItemToCreate="//L">
            <Attribute id="Line_object">204</Attribute>
            <Attribute id="Line_action">11</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">string(@fees)</Attribute>
            <Attribute id="Reference_no" isExpression="True" ExpressionSource="SourceFile">string(@employee)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine37A" ItemToCreate="//L">
            <Attribute id="Line_object">208</Attribute>
            <Attribute id="Line_action">11</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">string(@fees)</Attribute>
            <Attribute id="Reference_no" isExpression="True" ExpressionSource="SourceFile">string(@employee)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine38" ItemToCreate="//L">
            <Attribute id="Line_object">204</Attribute>
            <Attribute id="Line_action">12</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">string(@fees)</Attribute>
            <Attribute id="Reference_no" isExpression="True" ExpressionSource="SourceFile">string(@employee)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <!---->
          <CreateLineItem id="NewLine39" ItemToCreate="//L">
            <Attribute id="Line_object">202</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">string(@fees)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Conditions>
              <Condition id="1">
                <Expression>number(@fees) &gt;= 0 and @type != '1'</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" useIdentity="False">11</True>
              </Condition>
              <Condition id="1">
                <Expression>number(@fees) &lt; 0 and @type != '1'</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" useIdentity="False">12</True>
              </Condition>
            </Conditions>
          </CreateLineItem>
          <CreateLineItem id="NewLine40" ItemToCreate="//L">
            <Attribute id="Line_object">717</Attribute>
            <Attribute id="Line_action">16</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="CashInCashOutReason" ItemToCreate="//N">
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(following-sibling::L70[1]/@field)</Attribute>
            <Attribute id="Line_note_type">43</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
        </Action>
      </Actions>
    </Rule>
    <Rule id="L30" DestinationSavePath="//L" ProcessAsGroup="False" desc="Rules For L30 Record">
      <Mappings></Mappings>
      <Conditions>
        
          <!-- Micros processing of appeasments -->
          <Condition id="1" name="Condition1" GroupName="Apeasments">
          <Expression>number(@item) = '999995' and  number(./../L10/@reg_num) > 2 </Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="true">825</True>
        </Condition>
         <Condition id="1" name="Condition1" GroupName="Apeasments">
          <Expression>number(@item) = '999995' and  number(./../L10/@reg_num) > 2 </Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="true">15</True>
        </Condition>
        <Condition id="2" name="Condition2" GroupName="Apeasments">
          <Expression>number(@item) = '999995' and  number(./../L10/@reg_num) > 2</Expression>
          <Destination format="{0:f}" type="System.Decimal">//L/@Line_amount</Destination>
          <True isExpression="true" UseDefault="false" ContinueProcessing="false" ExpressionSource="SourceFile">string(@price)</True>
        </Condition>
        <!-- Micros processing of appeasments -->
            
        <Condition id="1" name="Condition1" GroupName="">
          <Expression>@typ_L30VALUC = '1'</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="False"></True>
        </Condition>
        <Condition id="2" name="Condition2" GroupName="GiftCard">
          <Expression>1 = 1</Expression>
          <Destination format="{0:f}" type="System.Decimal">//L/@Line_amount</Destination>
          <True isExpression="true" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile">string(@price)</True>
        </Condition>
        <Condition id="3" name="Condition3" GroupName="GiftCard">
          <Expression>1 = 1</Expression>
          <Destination format="{0:f}" type="System.Decimal">//L/@Line_amount_multiplication_factor</Destination>
          <True isExpression="true" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile">string(@qty)</True>
        </Condition>
        <Condition id="4" name="Condition4" GroupName="GiftCard">
          <Expression>1 = 1</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">1</True>
        </Condition>
        <Condition id="5" name="Condition5" GroupName="GiftCard">
          <Expression>@typ_L30GIFTS = '1'</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">624</True>
        </Condition>
        <Condition id="6" name="Condition6" GroupName="GiftCard">
          <Expression>@typ_L30GIFTS = '1'</Expression>
          <Destination>//L/@Reference_no</Destination>
          <True isExpression="True" ExpressionSource="SourceFile" UseDefault="false" ContinueProcessing="True">string(@item)</True>
        </Condition>
        <Condition id="7" name="Condition7" GroupName="NoTax">
          <Expression>number(@typ_L30GIFTS) = 0 and number(@flgs_L30NOTAX) = 0 </Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="True" ExpressionSource="SourceFile" UseDefault="false" ContinueProcessing="True">number(@journal_key)-1 + 100</True>
        </Condition>
        <Condition id="8" name="Condition8" GroupName="NoTax">
          <Expression>number(@typ_L30GIFTS) = 0 and number(@flgs_L30NOTAX) = 1</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="True" ExpressionSource="SourceFile" UseDefault="false" ContinueProcessing="True">200-number(@journal_key)</True>
        </Condition>

        <!--Temp Addition to handle Donation skus for SPIRIT that are coming in under Journal Key 3 (This can be dleted after the 2007 SPIRIT Season-->
        <!--<Condition id="8a" name="DonationCondition">
          <Expression>(number(@typ_L30GIFTS) = 0 and number(@flgs_L30NOTAX) = 1) and (number(@item) =976712 or number(@item) =976720 or number(@item) =976738)</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="True" ExpressionSource="SourceFile" UseDefault="false" ContinueProcessing="True">196</True>
        </Condition>-->

        <Condition id="9" name="Condition9" GroupName="NoTax">
          <Expression>number(@typ_L30GIFTS) = 0 and number(@flgs_L30NOTAX) = 0 and number(@journal_key) > 10 </Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="True" ExpressionSource="SourceFile" UseDefault="false" ContinueProcessing="True">100</True>
        </Condition>
        <!--old not needed anymore-->
        <!--<Condition id="10" name="Condition10" GroupName="NoTax">
					<Expression>number(@typ_L30GIFTS) = 0 and number(@flgs_L30NOTAX) = 1 and number(@journal_key) > 10</Expression>
					<Destination>//L/@Line_object</Destination>
					<True isExpression="True" ExpressionSource="SourceFile" UseDefault="false" ContinueProcessing="True">199</True>
				</Condition>-->

        <Condition id="11" name="Condition11" GroupName="NoTax">
          <Expression>number(@typ_L30GIFTS) = 0 and number(@flgs_L30NOTAX) = 0 and number(@journal_key) = 19</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="True" ExpressionSource="SourceFile" UseDefault="false" ContinueProcessing="True">number(@journal_key)-1 + 100</True>
        </Condition>
        <Condition id="12" name="Condition12" GroupName="NoTax">
          <Expression>number(@typ_L30GIFTS) = 0 and number(@flgs_L30NOTAX) = 1 and number(@journal_key) = 19</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="True" ExpressionSource="SourceFile" UseDefault="false" ContinueProcessing="True">200-number(@journal_key)</True>
        </Condition>
        <Condition id="13" name="Condition13">
          <Expression>./../L10/@type = '1' or (./../L10/@type = '2' and @return_reason != '0')</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True" Actionid="NewLine1">2</True>
        </Condition>
        <Condition id="14" name="Condition14" GroupName="InternetOrders">
          <Expression>@journal_key = '19' and @description = 'IORDSHIP'</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">204</True>
        </Condition>
        <Condition id="15" name="Condition15" GroupName="InternetOrders">
          <Expression>@journal_key = '19' and @description = 'IORDSHIP'</Expression>
          <Destination format="{0:f}" type="System.Decimal">//L/@Line_amount</Destination>
          <True isExpression="True" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile">string(@extended)</True>
        </Condition>
        <Condition id="16" name="Condition16" GroupName="InternetOrders">
          <Expression>(@journal_key = '19' and @description = 'IORDSHIP') and number(@extended) &gt; 0</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">11</True>
        </Condition>
        <Condition id="17" name="Condition17" GroupName="InternetOrders">
          <Expression>(@journal_key = '19' and @description = 'IORDSHIP') and number(@extended) &lt;= 0</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">12</True>
        </Condition>
        <Condition id="16" name="Condition16" GroupName="BAG Fees">
          <Expression>(@journal_key >= '21' and @journal_key &lt;= '25') and number(@extended) &gt; 0</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">11</True>
        </Condition>
        <Condition id="17" name="Condition17" GroupName="BAG Fees">
          <Expression>(@journal_key >= '21' and @journal_key &lt;= '25') and number(@extended) &lt;= 0</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">12</True>
        </Condition>
        <Condition id="18" name="Condition18" GroupName="InternetOrders">
          <Expression>@journal_key = '19' and @description != 'IORDSHIP'</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">202</True>
        </Condition>
        <Condition id="18" name="Condition18" GroupName="RestockingFee">
          <Expression>@journal_key = '19' and @description = 'RSTK'</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">204</True>
        </Condition>
        <Condition id="18" name="Condition18" GroupName="PitneyBowes">
          <Expression>@journal_key = '19' and @description = 'INTHANDFEE'</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">207</True>
        </Condition>
        <Condition id="19" name="Condition19" GroupName="InternetOrders">
          <Expression>@journal_key = '19' and @description != 'IORDSHIP'</Expression>
          <Destination format="{0:f}" type="System.Decimal">//L/@Line_amount</Destination>
          <True isExpression="True" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile">string(@extended)</True>
        </Condition>
        <Condition id="20" name="Condition20" GroupName="InternetOrders">
          <Expression>(@journal_key = '19' and @description != 'IORDSHIP') and number(@extended) &gt; 0</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">11</True>
        </Condition>
        <Condition id="21" name="Condition21" GroupName="InternetOrders">
          <Expression>(@journal_key = '19' and @description != 'IORDSHIP') and number(@extended) &lt;= 0</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">12</True>
        </Condition>
        <Condition id="22" name="Condition22" GroupName="MerchantGroup">
          <Expression>@typ_L30GIFTS = '0'</Expression>
          <Destination></Destination>
          <True isExpression="False" UesDefault="False" ContinueProcessing="True" Actionid="NewLine2"></True>
        </Condition>
        <Condition id="23" name="Condition23">
          <Expression>number(@for_qty) != 0</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLine3"></True>
        </Condition>
        <Condition id="24" name="Condition24">
          <Expression>number(@reason) != 0</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLine4"></True>
        </Condition>
        <Condition id="25" name="Condition25">
          <Expression>number(@return_reason) != 0</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLine5"></True>
        </Condition>
        <Condition id="26" name="Condition26">
          <Expression>number(@flgs_L30POVER) = 1 and number(@orig_price) != 0</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLine6"></True>
        </Condition>
        <Condition id="27" name="Condition27" GroupName="MerchantGroup">
          <Expression>(@typ_L30GIFTS = '0' and count(following-sibling::L36) > 0 and number(following-sibling::L36/@rettot) != 0 and ./../L10/@country != '1') and ((floor(number(./../L10/@qualify) div 128) mod 2 > 0) or (floor(number(./../L10/@qualify) div 1) mod 2 > 0) or (floor(number(./../L10/@qualify) div 16) mod 2 > 0))</Expression>
          <Destination></Destination>
          <True isExpression="False" UesDefault="False" ContinueProcessing="True" Actionid="NewLine7"></True>
        </Condition>
        <Condition id="28" name="Condition28" GroupName="MerchantGroup">
          <Expression>(@typ_L30GIFTS = '0' and count(following-sibling::L36) > 0 and ./../L10/@type != 2 and ./../L10/@country != '1') and ((floor(number(./../L10/@qualify) div 128) mod 2 > 0) or (floor(number(./../L10/@qualify) div 1) mod 2 > 0) or (floor(number(./../L10/@qualify) div 16) mod 2 > 0))</Expression>
          <Destination></Destination>
          <True isExpression="False" UesDefault="False" ContinueProcessing="True" Actionid="NewLine7"></True>
        </Condition>
        <Condition id="29" name="Condition29" GroupName="Canada Tax">
          <!--<Expression>(@typ_L30GIFTS = '0' and count(following-sibling::L36) > 0 and ./../L10/@type != 2 and ./../L10/@country = '1') and ((floor(number(./../L10/@qualify) div 128) mod 2 > 0) or (floor(number(./../L10/@qualify) div 1) mod 2 > 0) or (floor(number(./../L10/@qualify) div 16) mod 2 > 0))</Expression>-->
          <Expression>(@typ_L30GIFTS = '0' and ./../L10/@country = '1') and ((floor(number(./../L10/@qualify) div 128) mod 2 > 0) or (floor(number(./../L10/@qualify) div 1) mod 2 > 0) or (floor(number(./../L10/@qualify) div 16) mod 2 > 0))</Expression>
          <Destination></Destination>
          <True isExpression="False" UesDefault="False" ContinueProcessing="True" Actionid="NewLine8"></True>
        </Condition>
        <Condition id="30" name="Condition30" GroupName="Canada Tax">
          <!--<Expression>(@typ_L30GIFTS = '0' and count(following-sibling::L36) > 0 and ./../L10/@type != 2 and ./../L10/@country = '1') and ((floor(number(./../L10/@qualify) div 128) mod 2 > 0) or (floor(number(./../L10/@qualify) div 1) mod 2 > 0) or (floor(number(./../L10/@qualify) div 16) mod 2 > 0))</Expression>-->
          <Expression>(@typ_L30GIFTS = '0'  and ./../L10/@country = '1') and ((floor(number(./../L10/@qualify) div 128) mod 2 > 0) or (floor(number(./../L10/@qualify) div 1) mod 2 > 0) or (floor(number(./../L10/@qualify) div 16) mod 2 > 0))</Expression>
          <Destination></Destination>
          <True isExpression="False" UesDefault="False" ContinueProcessing="True" Actionid="NewLine9"></True>
        </Condition>
      </Conditions>
      <Actions>
        <Action>
          <CreateLineItem id="NewLine1" ItemToCreate="//R">
            <Attribute id="Return_reason_code" isExpression="True" ExpressionSource="SourceFile">string(@return_reason)</Attribute>
            <Attribute id="Return_from_register_no" isExpression="True" ExpressionSource="SourceFile">string(./../L10/@orig_reg_num)</Attribute>
            <Attribute id="Return_from_store_no" isExpression="True" ExpressionSource="SourceFile">string(./../L10/@orig_store_num)</Attribute>
            <Attribute id="Return_from_date" isExpression="True" ExpressionSource="SourceFile" format="{0:MM/dd/yyyy}" type="System.DateTime">string(./../L10/@orig_trans_date)</Attribute>
            <Attribute id="Return_from_transaction_no" isExpression="True" ExpressionSource="SourceFile">string(./../L10/@orig_trans_num)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine2" ItemToCreate="//M">
            <Attribute id="Units" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">string(@qty)</Attribute>
            <Attribute id="Salesperson" isExpression="True" ExpressionSource="SourceFile">string(./../L10/@cashier)</Attribute>
            <Attribute id="POS_dept_class" isExpression="True" ExpressionSource="SourceFile">string(@dept)</Attribute>
            <Attribute id="Scanned_flag" isExpression="True" ExpressionSource="SourceFile">string(@flgs_L30SCAND)</Attribute>
            <Attribute id="Price_override_flag" isExpression="True" ExpressionSource="SourceFile">string(@flgs_L30POVER)</Attribute>
            <Attribute id="UPC_missing_in_POS_IPLU_file_flag" isExpression="True" ExpressionSource="SourceFile">string(@flgs_L30NPLUS)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Conditions>
              <Condition id="1" GroupName="MerchantGroup">
                <Expression>number(@item) &gt; 0</Expression>
                <Destination>//M/@UPC</Destination>
                <True isExpression="True" UseDefault="False" ContinueProcessing="True" ExpressionSource="SourceFile">number(@item)</True>
              </Condition>
              <Condition id="2" GroupName="MerchantGroup">
                <Expression>number(@item) &gt; 0</Expression>
                <Destination>//M/@POS_item_identifier</Destination>
                <True isExpression="True" UseDefault="False" ContinueProcessing="True" ExpressionSource="SourceFile">number(@item)</True>
              </Condition>
              <Condition id="3" GroupName="MerchantGroup">
                <Expression>number(@item) &lt; 0</Expression>
                <Destination>//M/@UPC</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">13</True>
              </Condition>
              <Condition id="4" GroupName="MerchantGroup">
                <Expression>number(@item) &lt; 0</Expression>
                <Destination>//M/@POS_item_identifier</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">13</True>
              </Condition>
            </Conditions>
          </CreateLineItem>
          <CreateLineItem id="NewLine3" ItemToCreate="//N">
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(@for_qty)</Attribute>
            <Attribute id="Line_note_type">24</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine4" ItemToCreate="//N">
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(@reason)</Attribute>
            <Attribute id="Line_note_type">25</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine5" ItemToCreate="//N">
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(@return_reason)</Attribute>
            <Attribute id="Line_note_type">26</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine6" ItemToCreate="//N">
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">string(@orig_price)</Attribute>
            <Attribute id="Line_note_type">27</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine7" ItemToCreate="//T">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Tax_exempt_no" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(following-sibling::L36/@tax_num)</Attribute>
            <Attribute id="Exception_tax_jurisdiction" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(following-sibling::L36/@tax_state)</Attribute>
            <Attribute id="Taxable" useIdentity="False" isExpression="False" ExpressionSource="SourceFile">0</Attribute>
            <Conditions>
              <Condition>
                <Expression>(floor(number(./../L10/@qualify) div 128) mod 2 = 0) and string(@flgs_L30NOTAX) != '' and number(@flgs_L30NOTAX) = 0</Expression>
                <Destination>//T/@Taxable</Destination>
                <True isExpression="False" ExpressionSource="SourceFile"  UseDefault="False" ContinueProcessing="True">1</True>
              </Condition>
              <Condition id="1">
                <Expression>(floor(number(./../L10/@qualify) div 128) mod 2 > 0)</Expression>
                <Destination>//T/@Tax_category</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="False">3</True>
              </Condition>
              <Condition id="2">
                <Expression>(floor(number(./../L10/@qualify) div 1) mod 2 > 0)</Expression>
                <Destination>//T/@Tax_category</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="False">2</True>
              </Condition>
              <Condition id="2">
                <Expression>(floor(number(./../L10/@qualify) div 16) mod 2 > 0)</Expression>
                <Destination>//T/@Tax_category</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="False">1</True>
              </Condition>
            </Conditions>
          </CreateLineItem>
          <CreateLineItem id="NewLine8" ItemToCreate="//T">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <!--<Attribute id="Tax_exempt_no" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(following-sibling::L36/@tax_num)</Attribute>
            <Attribute id="Exception_tax_jurisdiction" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(following-sibling::L36/@tax_state)</Attribute>-->
            <Attribute id="Tax_exempt_no" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(./../L36[string(@tax_num)!= '']/@tax_num)</Attribute>
            <Attribute id="Exception_tax_jurisdiction" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(./../L36[string(@tax_state)!= '']/@tax_state)</Attribute>
            <Attribute id="Taxable" useIdentity="False" isExpression="False" ExpressionSource="SourceFile">1</Attribute>
            <Attribute id="Tax_level" useIdentity="False" isExpression="False" ExpressionSource="SourceFile">5</Attribute>
            <Attribute id="Tax_category" useIdentity="False" isExpression="False" ExpressionSource="SourceFile">0</Attribute>
            <Conditions>
              <Condition>
                <Expression>(floor(number(./../L10/@qualify) div 128) mod 2 = 0) and (string(@flgs_L30NOTAX) != '' and number(@flgs_L30NOTAX) = 0)</Expression>
                <Destination>//T/@Taxable</Destination>
                <True isExpression="False" ExpressionSource="SourceFile"  UseDefault="False" ContinueProcessing="True">1</True>
              </Condition>
              <Condition id="1">
                <Expression>string(./../L97/@fedtaxamt) != '' or number(./../L97/@fedtaxamt) != 0</Expression>
                <Destination>//T/@Tax_level</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">2</True>
              </Condition>
              <Condition id="1">
                <Expression>floor(number(./../L10/@qualify) div 128) mod 2 > 0 and (string(./../L97/@fedtaxamt) = '' or number(./../L97/@fedtaxamt) = 0)</Expression>
                <Destination>//T/@Tax_category</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="False">3</True>
              </Condition>
              <Condition id="2">
                <Expression>floor(number(./../L10/@qualify) div 1) mod 2 > 0 and (string(./../L97/@fedtaxamt) = '' or number(./../L97/@fedtaxamt) = 0)</Expression>
                <Destination>//T/@Tax_category</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="False">2</True>
              </Condition>
              <Condition id="2">
                <Expression>floor(number(./../L10/@qualify) div 16) mod 2 > 0 and (string(./../L97/@fedtaxamt) = '' or number(./../L97/@fedtaxamt) = 0)</Expression>
                <Destination>//T/@Tax_category</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="False">1</True>
              </Condition>
            </Conditions>
          </CreateLineItem>
          <CreateLineItem id="NewLine9" ItemToCreate="//T">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <!--<Attribute id="Tax_exempt_no" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(following-sibling::L36/@tax_num)</Attribute>-->
            <Attribute id="Tax_exempt_no" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(./../L36[string(@tax_num)!= '']/@tax_num)</Attribute>
            <!--<Attribute id="Exception_tax_jurisdiction" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(following-sibling::L36/@tax_state)</Attribute>-->
            <Attribute id="Exception_tax_jurisdiction" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(./../L36[string(@tax_state)!= '']/@tax_state)</Attribute>
            <Attribute id="Taxable" useIdentity="False" isExpression="False" ExpressionSource="SourceFile">0</Attribute>
            <Attribute id="Tax_level" useIdentity="False" isExpression="False" ExpressionSource="SourceFile">5</Attribute>
            <Attribute id="Tax_category" useIdentity="False" isExpression="False" ExpressionSource="SourceFile">0</Attribute>
            <Conditions>
              <Condition id="1">
                <Expression>string(./../L99/@taxes) != '' or number(./../L99/@taxes) != 0</Expression>
                <Destination>//T/@Tax_level</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">5</True>
              </Condition>
              <Condition>
                <Expression>(floor(number(./../L10/@qualify) div 128) mod 2 = 0) and (string(@flgs_L30NOTAX) != '' and number(@flgs_L30NOTAX) = 0)</Expression>
                <Destination>//T/@Taxable</Destination>
                <True isExpression="False" ExpressionSource="SourceFile"  UseDefault="False" ContinueProcessing="True">1</True>
              </Condition>
              <Condition id="1">
                <Expression>floor(number(./../L10/@qualify) div 128) mod 2 > 0 and (string(./../L99/@taxes) = '' or number(./../L99/@taxes)= 0) </Expression>
                <Destination>//T/@Tax_category</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="False">3</True>
              </Condition>
              <Condition id="2">
                <Expression>floor(number(./../L10/@qualify) div 1) mod 2 > 0 and (string(./../L99/@taxes) = '' or number(./../L99/@taxes)= 0)</Expression>
                <Destination>//T/@Tax_category</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="False">2</True>
              </Condition>
              <Condition id="2">
                <Expression>floor(number(./../L10/@qualify) div 16) mod 2 > 0 and (string(./../L99/@taxes) = '' or number(./../L99/@taxes)= 0)</Expression>
                <Destination>//T/@Tax_category</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="False">1</True>
              </Condition>
            </Conditions>
          </CreateLineItem>
        </Action>
      </Actions>
    </Rule>
    <Rule id="L31" DestinationSavePath="//D" ProcessAsGroup="False" desc="Rules For L31 Item Discount Record">
      <Mappings />
      <Conditions>
        <!--<Condition id="1" name="Condition1">
          <Expression>number(@discount) = 0 or string(@discount) = '' </Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="False" />
        </Condition>-->
        <Condition id="1" name="Condition1" GroupName="PromoDiscount">
          <Expression>(number(@flags) = 1 or number(@flags) = 65 or number(@flags) = 33 or number(@flags) = 97)</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLinePromo1">
          </True>
        </Condition>
        <Condition id="2" name="Condition2" GroupName="PromoDiscount">
          <Expression>(number(@flags) = 1 or number(@flags) = 65 or number(@flags) = 33 or number(@flags) = 97)</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLinePromo2">
          </True>
        </Condition>
        <Condition id="3" name="Condition3" GroupName="PromoDiscount">
          <Expression>(number(@flags) = 1 or number(@flags) = 65 or number(@flags) = 33 or number(@flags) = 97) and string(@deal) != ''</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLinePromo3">
          </True>
        </Condition>
        <Condition id="4" name="Condition4" GroupName="PromoDiscount">
          <Expression>(number(@flags) = 1 or number(@flags) = 65 or number(@flags) = 33 or number(@flags) = 97)  and string(@dealbase) != ''</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLinePromo4">
          </True>
        </Condition>
        <Condition id="5" name="Condition5" GroupName="PromoDiscount">
          <Expression>(number(@flags) = 1 or number(@flags) = 65 or number(@flags) = 33 or number(@flags) = 97) and string(@disctype) != ''</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLinePromo5">
          </True>
        </Condition>
        <Condition id="6" name="Condition6" GroupName="PromoDiscount">
          <Expression>(number(@flags) = 1 or number(@flags) = 65 or number(@flags) = 33 or number(@flags) = 97) and string(@promo_event) != ''</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLinePromo6">
          </True>
        </Condition>
        <Condition id="1" name="Condition1" GroupName="Deal">
          <Expression>(number(@flags) = 0 or number(@flags) = 32 or number(@flags) = 64 or number(@flags) = 96) and (number(@discflags) != 8 and number(@discflags) != 12 and number(@discflags) != 32778)</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLineDeal1">
          </True>
        </Condition>
        <Condition id="2" name="Condition2" GroupName="Deal">
          <Expression>(number(@flags) = 0 or number(@flags) = 32 or number(@flags) = 64 or number(@flags) = 96) and (number(@discflags) != 8 and number(@discflags) != 12 and number(@discflags) != 32778)</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLineDeal2">
          </True>
        </Condition>
        <Condition id="3" name="Condition3" GroupName="Deal">
          <Expression>(number(@flags) = 0 or number(@flags) = 32 or number(@flags) = 64 or number(@flags) = 96) and string(@applied_deal) != '' and (number(@discflags) != 8 and number(@discflags) != 12 and number(@discflags) != 32778)</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLineDeal3">
          </True>
        </Condition>
        <Condition id="4" name="Condition4" GroupName="Deal">
          <Expression>(number(@flags) = 0 or number(@flags) = 32 or number(@flags) = 64 or number(@flags) = 96)  and string(@dealbase) != '' and (number(@discflags) != 8 and number(@discflags) != 12 and number(@discflags) != 32778)</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLineDeal4">
          </True>
        </Condition>
        <Condition id="5" name="Condition5" GroupName="Deal">
          <Expression>(number(@flags) = 0 or number(@flags) = 32 or number(@flags) = 64 or number(@flags) = 96) and string(@disctype) != '' and (number(@discflags) != 8 and number(@discflags) != 12 and number(@discflags) != 32778)</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLineDeal5">
          </True>
        </Condition>
        <Condition id="1" name="Condition1" GroupName="CouponTriggeredDeal">
          <Expression>(number(@flags) = 0 or number(@flags) = 32 or number(@flags) = 64 or number(@flags) = 96) and (number(@discflags) = 8 or number(@discflags) = 12 or number(@discflags) = 32778)</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLineDeal1">
          </True>
        </Condition>        
        <Condition id="2" name="Condition2" GroupName="CouponTriggeredDeal">
          <Expression>(number(@flags) = 0 or number(@flags) = 32 or number(@flags) = 64 or number(@flags) = 96) and (number(@discflags) = 8 or number(@discflags) = 12 or number(@discflags) = 32778)</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLineDeal6">
          </True>
        </Condition>          
        <Condition id="3" name="Condition3" GroupName="CouponTriggeredDeal">
          <Expression>(number(@flags) = 0 or number(@flags) = 32 or number(@flags) = 64 or number(@flags) = 96) and string(@applied_deal) != '' and (number(@discflags) = 8 or number(@discflags) = 12 or number(@discflags) = 32778)</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLineDeal3">
          </True>
        </Condition>
        <Condition id="4" name="Condition4" GroupName="CouponTriggeredDeal">
          <Expression>(number(@flags) = 0 or number(@flags) = 32 or number(@flags) = 64 or number(@flags) = 96)  and string(@dealbase) != '' and (number(@discflags) = 8 or number(@discflags) = 12 or number(@discflags) = 32778)</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLineDeal4">
          </True>
        </Condition>
        <Condition id="5" name="Condition5" GroupName="CouponTriggeredDeal">
          <Expression>(number(@flags) = 0 or number(@flags) = 32 or number(@flags) = 64 or number(@flags) = 96) and string(@disctype) != '' and (number(@discflags) = 8 or number(@discflags) = 12 or number(@discflags) = 32778)</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLineDeal5">
          </True>
        </Condition>        
        <Condition id="6" name="Condition6" GroupName="CouponTriggeredDeal">
          <Expression>(number(@flags) = 0 or number(@flags) = 32 or number(@flags) = 64 or number(@flags) = 96) and string(@reason_code_description) != '' and (number(@discflags) = 8 or number(@discflags) = 12 or number(@discflags) = 32778)</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLineDeal7">
          </True>
        </Condition>
        <Condition id="7" name="Condition7" GroupName="CouponTriggeredDeal">
          <Expression>(number(@flags) = 0 or number(@flags) = 32 or number(@flags) = 64 or number(@flags) = 96) and string(@tlog_reason_code) != '' and (number(@discflags) = 8 or number(@discflags) = 12 or number(@discflags) = 32778)</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLineDeal8">
          </True>
        </Condition>
        <Condition id="8" name="Condition8" GroupName="CouponTriggeredDeal">
          <Expression>(number(@flags) = 0 or number(@flags) = 32 or number(@flags) = 64 or number(@flags) = 96) and string(@coupon_barcode_data) != '' and (number(@discflags) = 8 or number(@discflags) = 12 or number(@discflags) = 32778)</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLineDeal9">
          </True>
        </Condition>
        <Condition id="9" name="Condition9" GroupName="CouponTriggeredDeal">
          <Expression>(number(@flags) = 0 or number(@flags) = 32 or number(@flags) = 64 or number(@flags) = 96) and number(@coupon_entry_method) != '' and (number(@discflags) = 8 or number(@discflags) = 12 or number(@discflags) = 32778)</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLineDeal10">
          </True>
        </Condition>
        <Condition id="10" name="Condition10" GroupName="CouponTriggeredDeal">
          <Expression>(number(@flags) = 0 or number(@flags) = 32 or number(@flags) = 64 or number(@flags) = 96) and string(@coupon_identifier) != '' and (number(@discflags) = 8 or number(@discflags) = 12 or number(@discflags) = 32778)</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLineDeal11">
          </True>
        </Condition>
        <Condition id="11" name="Condition11" GroupName="CouponTriggeredDeal">
          <Expression>(number(@flags) = 0 or number(@flags) = 32 or number(@flags) = 64 or number(@flags) = 96) and number(@reason) != '' and (number(@discflags) = 8 or number(@discflags) = 12 or number(@discflags) = 32778)</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLineDeal12">
          </True>
        </Condition>
        <Condition id="1" name="Condition1" GroupName="Discounts">
          <Expression>(number(@flags) = 2 or number(@flags) = 66 or number(@flags) = 34 or number(@flags) = 98 or number(@disctype) = 8)</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLineDiscount1">
          </True>
        </Condition>
        <Condition id="2" name="Condition2" GroupName="Discounts">
          <Expression>(number(@flags) = 2 or number(@flags) = 66 or number(@flags) = 34 or number(@flags) = 98 or number(@disctype) = 8)</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLineDiscount2">
          </True>
        </Condition>
        <Condition id="3" name="Condition3" GroupName="Discounts">
          <Expression>(number(@flags) = 2 or number(@flags) = 66 or number(@flags) = 34 or number(@flags) = 98 or number(@disctype) = 8) and string(@reason) != ''</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLineDiscount3">
          </True>
        </Condition>
        <Condition id="4" name="Condition4" GroupName="Discounts">
          <Expression>(number(@flags) = 2 or number(@flags) = 66 or number(@flags) = 34 or number(@flags) = 98 or number(@disctype) = 8) and string(@disctype) != ''</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLineDiscount4">
          </True>
        </Condition>
        <Condition id="5" name="Condition5" GroupName="Discounts">
          <Expression>(number(@flags) = 2 or number(@flags) = 66 or number(@flags) = 34 or number(@flags) = 98) and string(@disctype) != ''</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLineDiscount5">
          </True>
        </Condition>
        <Condition id="6" name="Condition6" GroupName="Discounts">
          <Expression>(number(@flags) = 2 or number(@flags) = 66 or number(@flags) = 34 or number(@flags) = 98) and string(@disctype) != ''</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLineDiscount6">
          </True>
        </Condition>
        <Condition id="7" name="Condition7" GroupName="Discounts">
          <Expression>(number(@flags) = 2 or number(@flags) = 66 or number(@flags) = 34 or number(@flags) = 98) and string(@disctype) != ''</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLineDiscount7">
          </True>
        </Condition>
        <Condition id="8" name="Condition8" GroupName="Discounts">
          <Expression>(number(@flags) = 2 or number(@flags) = 66 or number(@flags) = 34 or number(@flags) = 98) and string(@disctype) != ''</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLineDiscount8">
          </True>
        </Condition>
        <Condition id="9" name="Condition9" GroupName="Discounts">
          <Expression>(number(@flags) = 2 or number(@flags) = 66 or number(@flags) = 34 or number(@flags) = 98) and string(@disctype) != ''</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLineDiscount9">
          </True>
        </Condition>

      </Conditions>
      <Actions>
        <Action>
          <CreateLineItem id="NewLinePromo1" ItemToCreate="//D">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Applied_by_line_id" useIdentity="False" isExpression="True" ExpressionSource="DestinationFile">number(@Line_id) + 1</Attribute>
            <Attribute id="Discount_amount" useIdentity="False" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@discount)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLinePromo2" ItemToCreate="//L">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_object" useIdentity="False" isExpression="False" ExpressionSource="SourceFile">1601</Attribute>
            <Attribute id="Line_action" useIdentity="False" isExpression="False" ExpressionSource="SourceFile">20</Attribute>
            <Attribute id="Line_amount" useIdentity="False" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@discount)</Attribute>
            <Conditions>
              <Condition id="1">
                <Expression>(floor(number(./../L10/@type) div 1) mod 2 > 0 or floor(number(./../L10/@type) div 3) mod 2 > 0) and  number(preceding-sibling::L30[1]/@return_reason) != 0</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">21</True>
              </Condition>
            </Conditions>
          </CreateLineItem>
          <CreateLineItem id="NewLinePromo3" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">20</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(@applied_deal)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLinePromo4" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">21</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(@dealbase)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLinePromo5" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">18</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(@disctype)</Attribute>
            <Conditions>
              <Condition id="1">
                <Expression>string(@disctype) = '1'</Expression>
                <Destination>//N/@Line_Note</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">4</True>
              </Condition>
              <Condition id="2">
                <Expression>string(@disctype) = '3'</Expression>
                <Destination>//N/@Line_Note</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">1</True>
              </Condition>
            </Conditions>
          </CreateLineItem>
          <CreateLineItem id="NewLinePromo6" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">23</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(@promo_event)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLineDeal1" ItemToCreate="//D">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Applied_by_line_id" useIdentity="False" isExpression="True" ExpressionSource="DestinationFile">number(@Line_id) + 1</Attribute>
            <Attribute id="Discount_amount" useIdentity="False" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@discount)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLineDeal2" ItemToCreate="//L">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_object" useIdentity="False" isExpression="False" ExpressionSource="SourceFile">1608</Attribute>
            <Attribute id="Line_action" useIdentity="False" isExpression="False" ExpressionSource="SourceFile">20</Attribute>
            <Attribute id="Line_amount" useIdentity="False" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@discount)</Attribute>
            <Conditions>
              <Condition id="1">
                <Expression>(floor(number(./../L10/@type) div 1) mod 2 > 0 or floor(number(./../L10/@type) div 3) mod 2 > 0) and  number(preceding-sibling::L30[1]/@return_reason) != 0</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">21</True>
              </Condition>
            </Conditions>
          </CreateLineItem>
          <CreateLineItem id="NewLineDeal3" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">20</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(@applied_deal)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLineDeal4" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">21</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(@dealbase)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLineDeal5" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">18</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(@disctype)</Attribute>
            <Conditions>
              <Condition id="1">
                <Expression>string(@disctype) = '1'</Expression>
                <Destination>//N/@Line_Note</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">4</True>
              </Condition>
              <Condition id="2">
                <Expression>string(@disctype) = '3'</Expression>
                <Destination>//N/@Line_Note</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">1</True>
              </Condition>
            </Conditions>
          </CreateLineItem>
          <CreateLineItem id="NewLineDeal6" ItemToCreate="//L">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_object" useIdentity="False" isExpression="False" ExpressionSource="SourceFile">1609</Attribute>
            <Attribute id="Line_action" useIdentity="False" isExpression="False" ExpressionSource="SourceFile">20</Attribute>
            <Attribute id="Line_amount" useIdentity="False" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@discount)</Attribute>
            <Conditions>
              <Condition id="1">
                <Expression>(floor(number(./../L10/@type) div 1) mod 2 > 0 or floor(number(./../L10/@type) div 3) mod 2 > 0) and  number(preceding-sibling::L30[1]/@return_reason) != 0</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">21</True>
              </Condition>
            </Conditions>
          </CreateLineItem>
          <CreateLineItem id="NewLineDeal7" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">52</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(@reason_code_description)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLineDeal8" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">53</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(@tlog_reason_code)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLineDeal9" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">54</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(@coupon_barcode_data)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLineDeal10" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">55</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">number(@coupon_entry_method)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLineDeal11" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">56</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(@coupon_identifier)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLineDeal12" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">17</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">number(@reason)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLineDiscount1" ItemToCreate="//D">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Applied_by_line_id" useIdentity="False" isExpression="True" ExpressionSource="DestinationFile">number(@Line_id) + 1</Attribute>
            <Attribute id="Discount_amount" useIdentity="False" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@discount)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLineDiscount2" ItemToCreate="//L">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_action" useIdentity="False">20</Attribute>
            <Attribute id="Line_amount" useIdentity="False" isExpression="true" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@discount)</Attribute>
            <Conditions>
              <Condition id="1">
                <Expression>number(@flags) = 2 or number(@flags) = 66 or number(@flags) = 34 or number(@flags) = 98</Expression>
                <Destination>//L/@Line_object</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">1602</True>
              </Condition>
              <Condition id="2">
                <Expression>number(@disctype) = 8</Expression>
                <Destination>//L/@Line_object</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">1680</True>
              </Condition>
              <Condition id="3">
                <!--<Expression>(./../L10/@type = '1' or ./../L10/@type = '2') and  number(preceding-sibling::L30[1]/@return_reason) != 0</Expression>-->
                <Expression>floor(number(./../L10/@type) div 1) mod 2 > 0 or (floor(number(./../L10/@type) div 2) mod 2 > 0 and  number(preceding-sibling::L30[1]/@return_reason) != 0)</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">21</True>
              </Condition>
            </Conditions>
          </CreateLineItem>
          <CreateLineItem id="NewLineDiscount3" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">17</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(@reason)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLineDiscount4" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">18</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(@disctype)</Attribute>
            <Conditions>
              <Condition id="1">
                <Expression>string(@disctype) = '1'</Expression>
                <Destination>//N/@Line_Note</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">4</True>
              </Condition>
              <Condition id="2">
                <Expression>string(@disctype) = '3'</Expression>
                <Destination>//N/@Line_Note</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">1</True>
              </Condition>
            </Conditions>
          </CreateLineItem>
          <CreateLineItem id="NewLineDiscount5" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">52</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(@reason_code_description)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLineDiscount6" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">53</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(@tlog_reason_code)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLineDiscount7" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">54</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(@coupon_barcode_data)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLineDiscount8" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">55</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(@coupon_entry_method)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLineDiscount9" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">56</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(@coupon_identifier)</Attribute>
          </CreateLineItem>
        </Action>
      </Actions>
    </Rule>
    <Rule id="L32" DestinationSavePath="//D" ProcessAsGroup="False" desc="Rules For L32 Group Discount Record">
      <Mappings></Mappings>
      <Conditions>
        <Condition id="1" name="Condition1">
          <Expression>number(@emplgroup) + number(@empltran) + number(@trandisc) + number(@prefdisc) + number(@groupdisc) = 0</Expression>
          <Destination></Destination>
          <True isExpression="False" ContinueProcessing="False" UseDefault="False">
          </True>
        </Condition>
        <Condition id="2" name="Condition2">
          <Expression>number(@flags) &gt; 0</Expression>
          <Destination></Destination>
          <True isExpression="False" ContinueProcessing="True" UseDefault="False" Actionid="NewLine1">
          </True>
        </Condition>
        <Condition id="3" name="Condition3">
          <Expression>number(@flags) &gt; 0</Expression>
          <Destination></Destination>
          <True isExpression="False" ContinueProcessing="True" UseDefault="False" Actionid="NewLine2">
          </True>
        </Condition>
        <Condition id="4" name="Condition4">
          <Expression>number(@flags) &gt; 0 and (number(@flags) = 4 or (number(@flags) =8 and number(./../L12/@employee) &gt; 0)) </Expression>
          <Destination></Destination>
          <True isExpression="False" ContinueProcessing="True" UseDefault="False" Actionid="NewLine3">
          </True>
        </Condition>
        <Condition id="5" name="Condition5">
          <Expression>number(@flags) &gt; 0 and number(@groupreason) &gt; 0</Expression>
          <Destination></Destination>
          <True isExpression="False" ContinueProcessing="True" UseDefault="False" Actionid="NewLine4">
          </True>
        </Condition>
        <Condition id="6" name="Condition6">
          <Expression>number(@flags) &gt; 0 and number(@tranreason) &gt; 0</Expression>
          <Destination></Destination>
          <True isExpression="False" ContinueProcessing="True" UseDefault="False" Actionid="NewLine5">
          </True>
        </Condition>
        <Condition id="7" name="Condition7">
          <Expression>number(@flags) &gt; 0 and number(@grouptype) &gt; 0</Expression>
          <Destination></Destination>
          <True isExpression="False" ContinueProcessing="True" UseDefault="False" Actionid="NewLine6">
          </True>
        </Condition>
        <Condition id="8" name="Condition8">
          <Expression>number(@flags) &gt; 0 and number(@transtype) &gt; 0</Expression>
          <Destination></Destination>
          <True isExpression="False" ContinueProcessing="True" UseDefault="False" Actionid="NewLine7">
          </True>
        </Condition>


        <Condition id="10" name="Condition9" GroupName="Discounts">
          <Expression>number(@flags) &gt; 0</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLine8">
          </True>
        </Condition>
        <Condition id="10" name="Condition10" GroupName="Discounts">
          <Expression>number(@flags) &gt; 0</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLine9">
          </True>
        </Condition>
        <Condition id="10" name="Condition11" GroupName="Discounts">
          <Expression>number(@flags) &gt; 0</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLine10">
          </True>
        </Condition>
        <Condition id="10" name="Condition12" GroupName="Discounts">
          <Expression>number(@flags) &gt; 0</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLine11">
          </True>
        </Condition>
        <Condition id="10" name="Condition13" GroupName="Discounts">
          <Expression>number(@flags) &gt; 0</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLine12">
          </True>
        </Condition>

      </Conditions>
      <Actions>
        <Action>
          <CreateLineItem id="NewLine1" ItemToCreate="//D">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Applied_by_line_id" useIdentity="False" isExpression="True" ExpressionSource="DestinationFile">number(@Line_id) + 1</Attribute>
            <Attribute id="Discount_amount" isExpression="True" useIdentity="False" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@emplgroup) + number(@empltran) + number(@trandisc) + number(@prefdisc) + number(@groupdisc)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine2" ItemToCreate="//L">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_action" useIdentity="False">20</Attribute>
            <Attribute id="Line_amount" isExpression="True" useIdentity="False" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@emplgroup) + number(@empltran) + number(@trandisc) + number(@prefdisc) + number(@groupdisc)</Attribute>
            <Conditions>
              <Condition id="1">
                <Expression>number(@flags) = 4 or number(@flags) = 8 or number(@flags) = 260 or number(@flags) = 264</Expression>
                <Destination>//L/@Line_object</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False">1610</True>
              </Condition>
              <Condition id="2">
                <Expression>number(@flags) = 2 or number(@flags) = 1 or number(@flags) = 256 or number(@flags) = 258 or number(@flags) = 257</Expression>
                <Destination>//L/@Line_object</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False">1604</True>
              </Condition>
              <Condition id="3">
                <!--<Expression>(number(./../L10/@type) = 1) or (number(./../L10/@type) = 2 and number(./../L30/@return_reason !=0)) and number(./../L10/@qualify) != 4</Expression>-->
                <Expression>(number(./../L10/@type) = 1) or (number(./../L10/@type) = 2 and  number(preceding-sibling::L30[1]/@return_reason) != 0) and number(./../L10/@qualify) != 4</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False">21</True>
              </Condition>
            </Conditions>
          </CreateLineItem>
          <CreateLineItem id="NewLine3" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(./../L12/@employee)</Attribute>
            <Attribute id="Line_note_type">40</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine4" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(@groupreason)</Attribute>
            <Attribute id="Line_note_type">22</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine5" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(@tranreason)</Attribute>
            <Attribute id="Line_note_type">22</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine6" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(@grouptype)</Attribute>
            <Attribute id="Line_note_type">18</Attribute>
            <Conditions>
              <Condition id="1">
                <Expression>string(@grouptype) = '1'</Expression>
                <Destination>//N/@Line_Note</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">4</True>
              </Condition>
              <Condition id="2">
                <Expression>string(@grouptype) = '3'</Expression>
                <Destination>//N/@Line_Note</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">1</True>
              </Condition>
            </Conditions>
          </CreateLineItem>
          <CreateLineItem id="NewLine7" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(@transtype)</Attribute>
            <Attribute id="Line_note_type">18</Attribute>
            <Conditions>
              <Condition id="1">
                <Expression>string(@transtype) = '1'</Expression>
                <Destination>//N/@Line_Note</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">4</True>
              </Condition>
              <Condition id="2">
                <Expression>string(@transtype) = '3'</Expression>
                <Destination>//N/@Line_Note</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">1</True>
              </Condition>
            </Conditions>
          </CreateLineItem>

          <CreateLineItem id="NewLine8" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">52</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(@reason_code_description)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine9" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">53</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(@tlog_reason_code)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine10" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">54</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(@coupon_barcode_data)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine11" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">55</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(@coupon_entry_method)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine12" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">56</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(@coupon_identifier)</Attribute>
          </CreateLineItem>


        </Action>
      </Actions>
    </Rule>
    <!--<Rule id="L33" DestinationSavePath="//L" ProcessAsGroup="False" desc="Rules For L33 Item Correct Record">
      <Mappings>
        <Mapping id="Mapping1">
          <Source>number(98)</Source>
          <Destination>//L/@Line_object</Destination>
        </Mapping>
        <Mapping id="Mapping2">
          <Source>number(8)</Source>
          <Destination>//L/@Line_action</Destination>
        </Mapping>
      </Mappings>
      <Conditions>
        <Condition id="2" name="Condition2" GroupName="GiftCard">
          <Expression>1 = 1</Expression>
          <Destination format="{0:f}" type="System.Decimal">//L/@Line_amount</Destination>
          <True isExpression="true" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile" Actionid="NewLine1">string(@price)</True>
        </Condition>
      </Conditions>
      <Actions>
        <Action>
          <CreateLineItem id="NewLine1" ItemToCreate="//M">
            <Attribute id="Units" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">string(@qty)</Attribute>
            <Attribute id="Salesperson" isExpression="True" ExpressionSource="SourceFile">string(./../L10/@cashier)</Attribute>
            <Attribute id="POS_dept_class" isExpression="True" ExpressionSource="SourceFile">string(@dept)</Attribute>
            <Attribute id="Scanned_flag" isExpression="True" ExpressionSource="SourceFile">string(@flgs_L30SCAND)</Attribute>
            <Attribute id="Price_override_flag" isExpression="True" ExpressionSource="SourceFile">string(@flgs_L30POVER)</Attribute>
            <Attribute id="UPC_missing_in_POS_IPLU_file_flag" isExpression="True" ExpressionSource="SourceFile">string(@flgs_L30NPLUS)</Attribute>
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Conditions>
              <Condition id="1" GroupName="MerchantGroup">
                <Expression>number(@item) &gt; 0</Expression>
                <Destination>//M/@UPC</Destination>
                <True isExpression="True" UseDefault="False" ContinueProcessing="True" ExpressionSource="SourceFile">number(@item)</True>
              </Condition>
              <Condition id="2" GroupName="MerchantGroup">
                <Expression>number(@item) &gt; 0</Expression>
                <Destination>//M/@POS_item_identifier</Destination>
                <True isExpression="True" UseDefault="False" ContinueProcessing="True" ExpressionSource="SourceFile">number(@item)</True>
              </Condition>
              <Condition id="3" GroupName="MerchantGroup">
                <Expression>number(@item) &lt; 0</Expression>
                <Destination>//M/@UPC</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">13</True>
              </Condition>
              <Condition id="4" GroupName="MerchantGroup">
                <Expression>number(@item) &lt; 0</Expression>
                <Destination>//M/@POS_item_identifier</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">13</True>
              </Condition>
            </Conditions>
          </CreateLineItem>
        </Action>
      </Actions>
    </Rule>-->


    <Rule id="L36" DestinationSavePath="//T" ProcessAsGroup="False" desc="Rules For L36 Tax Exempt Record">
      <Mappings></Mappings>
      <Conditions>
        <Condition id="1" name="Condition2" GroupName="Tax Exempt">
          <Expression>number(@rettax) != 0 and  (floor(number(./../L10/@qualify) div 1) mod 2 > 0)</Expression>
          <Destination></Destination>
          <True isExpression="False" ExpressionSource="SourceFile" UseDefault="False" Actionid="NewLine1"></True>
        </Condition>
        <Condition id="2" name="Condition3" GroupName="Tax Exempt">
          <Expression>number(@rettax) != 0 and ((floor(number(./../L10/@qualify) div 128) mod 2 = 0)  and (floor(number(./../L10/@qualify) div 1) mod 2 = 0)  and (floor(number(./../L10/@qualify) div 16) mod 2 = 0) )</Expression>
          <Destination></Destination>
          <True isExpression="False" ExpressionSource="SourceFile" UseDefault="False" Actionid="NewLine1"></True>
        </Condition>
      </Conditions>
      <Actions>
        <Action>
          <CreateLineItem id="NewLine1" ItemToCreate="//L">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@rettax) - sum(./../L38[@tax_amount &lt; 0]/@tax_amount)</Attribute>
            <Conditions>
              <Condition id="1">
                <Expression>number(./../L10/@country) = 1</Expression>
                <Destination>//L/@Line_object</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False">503</True>
              </Condition>
              <Condition id="2">
                <Expression>number(./../L10/@country) != 1</Expression>
                <Destination>//L/@Line_object</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False">500</True>
              </Condition>
              <Condition id="3">
                <Expression>number(@rettax) >= 0</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False">11</True>
                <False isExpression="False" ContinueProcessing="True" UseDefault="False">12</False>
              </Condition>
            </Conditions>
          </CreateLineItem>
        </Action>
      </Actions>
    </Rule>
    <Rule id="L37" DestinationSavePath="//T" ProcessAsGroup="False" desc="Rules For L37 Tax Record">
      <Mappings></Mappings>
      <Conditions>
        <Condition id="1" name="Condition2">
          <Expression>string(@retspecfee) != '' and number(@retspecfee) != 0</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" Actionid="NewLine1" ContinueProcessing="True"></True>
        </Condition>
        <Condition id="2" name="Condition3">
          <Expression>string(@retgsttax) != '' and number(@retgsttax) != 0</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" Actionid="NewLine2" ContinueProcessing="True"></True>
        </Condition>
        <Condition id="2" name="Condition4">
          <Expression>string(@rethsttax) != '' and number(@rethsttax) != 0</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" Actionid="NewLine3" ContinueProcessing="True"></True>
        </Condition>

      </Conditions>
      <Actions>
        <Action>
          <CreateLineItem id="NewLine1" ItemToCreate="//L">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_object" useIdentity="False">502</Attribute>
            <Attribute id="Line_action" useIdentity="False">12</Attribute>
            <Conditions>
              <Condition id="1">
                <Expression>string(@retspecfee) != ''</Expression>
                <Destination>//L/@Line_amount</Destination>
                <True isExpression="True" UseDefault="False" ContinueProcessing="True"  format="{0:f}" type="System.Decimal" ExpressionSource="SourceFile">number(@retspecfee)</True>
                <False isExpression="False" UseDefault="False"  ContinueProcessing="True">0</False>
              </Condition>
            </Conditions>
          </CreateLineItem>
          <CreateLineItem id="NewLine2" ItemToCreate="//L">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_object" useIdentity="False">501</Attribute>
            <Attribute id="Line_amount" useIdentity="False" isExpression="True" ExpressionSource="SourceFile"  format="{0:f}" type="System.Decimal">number(@retgsttax)</Attribute>
            <Conditions>
              <Condition id="1">
                <Expression>number(@retgsttax) &gt;= 0</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False">11</True>
              </Condition>
              <Condition id="2">
                <Expression>number(@retgsttax) &lt; 0</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False">12</True>
              </Condition>
            </Conditions>
          </CreateLineItem>
          <CreateLineItem id="NewLine3" ItemToCreate="//L">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_object" useIdentity="False">506</Attribute>
            <Attribute id="Line_amount" useIdentity="False"  isExpression="True" ExpressionSource="SourceFile">string(@rethsttax)</Attribute>
            <Conditions>
              <Condition id="1">
                <Expression>number(@rethsttax) &gt;= 0</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False">11</True>
              </Condition>
              <Condition id="2">
                <Expression>number(@rethsttax) &lt; 0</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False">12</True>
              </Condition>

            </Conditions>
          </CreateLineItem>
        </Action>
      </Actions>
    </Rule>
    <Rule id="L38" DestinationSavePath="//L" ProcessAsGroup="False" desc="Rules For L38 Item Taxation Record">
      <Mappings>
        <Mapping id="Mapping1">
          <Source>503 + number(@item_tax_type)</Source>
          <Destination>//L/@Line_object</Destination>
        </Mapping>
        <Mapping id="Mapping2">
          <Source>number(@tax_amount)</Source>
          <Destination>//L/@Line_amount</Destination>
        </Mapping>
      </Mappings>
      <Conditions>
        <Condition id="1">
          <Expression>number(@tax_amount) &gt;= 0</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="False" ContinueProcessing="True" UseDefault="False">11</True>
        </Condition>
        <Condition id="2">
          <Expression>number(@tax_amount) &lt;= 0</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="False" ContinueProcessing="True" UseDefault="False">12</True>
        </Condition>
      </Conditions>
      <Actions></Actions>
    </Rule>
    <Rule id="L44" DestinationSavePath="//L" ProcessAsGroup="False" desc="Rules For L44 Endorsable Tender Record">
      <Mappings></Mappings>
      <Conditions>
        <Condition id="1" name="Condition1">
          <Expression>number(@type) = 17 and ./../L10/@type != 41 </Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="False"></True>
        </Condition>
        <Condition id="2" name="Condition2">
          <Expression>number(@type) = 18</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="False"></True>
        </Condition>
        <Condition id="3" name="Condition3">
          <!--A hack to make sure this always happens.  Should make a change to make an empty expression = true. -->
          <Expression>1 = 1</Expression>
          <Destination format="{0:f}" type="System.Decimal">//L/@Line_amount</Destination>
          <True isExpression="True" UseDefault="false" ContinueProcessing="true" ExpressionSource="SourceFile">number(@amount)</True>
        </Condition>
        <Condition id="3" name="Condition3">
          <!--the balance will be greater than 0 in ecomm when the order does not balance.  This will create a balanced transaction -->
          <Expression>string(@balance) != "" and number(@balance) != 0</Expression>
          <Destination format="{0:f}" type="System.Decimal">//L/@Line_amount</Destination>
          <True isExpression="True" UseDefault="false" ContinueProcessing="true" ExpressionSource="SourceFile">number(@balance)</True>
        </Condition>
        <Condition id="4" name="Condition4">
          <Expression>1 = 1</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="True" UseDefault="false" ContinueProcessing="true" ExpressionSource="SourceFile">number(@type) + 600</True>
        </Condition>
        <Condition id="5" name="Condition5">
          <Expression>number(@type) = 7</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">604</True>
        </Condition>
        <Condition id="6" name="Condition6">
          <Expression>number(@type) = 8</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">605</True>
        </Condition>
        <Condition id="7" name="Condition7">
          <Expression>number(@type) = 10 or number(@type) = 9</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">606</True>
        </Condition>
        <Condition id="8" name="Condition8">
          <Expression>number(@type) = 11</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">617</True>
        </Condition>
        <Condition id="9" name="Condition9">
          <Expression>number(@type) = 12</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">608</True>
        </Condition>
        <Condition id="13" name="Condition13">
          <Expression>number(@type) = 13</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">612</True>
        </Condition>
        <!-- this is getting set to 609 by default for porto rico stores-->
        <Condition id="10" name="Condition10">
          <Expression>number(@type) = 14</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">609</True>
        </Condition>
        <Condition id="17" name="Condition17">
          <Expression>number(@type) = 14 and number(./../L10/@country) = 0 </Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">632</True>
        </Condition>
        <!-- when all stores are on debit the code above should be removed.  object 632 is for ECH-->
        <Condition id="17" name="Condition17">
          <Expression>number(@type) = 14 and number(./../L10/@country) = 0 and name(following-sibling::*) = 'L45'</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">608</True>
        </Condition>
        <Condition id="12" name="Condition12">
          <Expression>number(@type) = 16</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">611</True>
        </Condition>
        <Condition id="16" name="Condition16">
          <Expression>number(@type) = 17</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">620</True>
        </Condition>
        <Condition id="15" name="Condition15">
          <Expression>number(@type) = 18</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">617</True>
        </Condition>
        <Condition id="11" name="Condition11">
          <Expression>number(@type) = 19</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">610</True>
        </Condition>
        <Condition id="14" name="Condition14">
          <Expression>number(@type) = 20</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">627</True>
        </Condition>
        <Condition id="14" name="Condition14">
          <Expression>number(@type) = 99</Expression>
          <!--Internet Orders PayPal Tender.  Trovato should not reach 99-->
          <Destination>//L/@Line_object</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">637</True>
        </Condition>
        <Condition id="14" name="Condition14">
          <Expression>number(@type) = 98</Expression>
          <!--Internet Orders Amazon Tender. -->
          <Destination>//L/@Line_object</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">638</True>
        </Condition>
        <Condition id="18" name="Condition18">
          <Expression>number(@flags) = 4</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">32</True>
        </Condition>
        <Condition id="19" name="Condition19">
          <Expression>number(@flags) != 4 and ((number(@type) = 0 or number(@type) = 1) and number(@amount) &lt; 0)</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">18</True>
        </Condition>
        <Condition id="20" name="Condition20">
          <Expression>number(@flags) != 4 and ((number(@type) = 0 or number(@type) = 1) and number(@amount) &gt; 0)</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">28</True>
        </Condition>
        <Condition id="21" name="Condition21">
          <Expression>number(@flags) != 4 and ((number(@type) = 0 or number(@type) = 1) and number(@amount) &gt; 0 and number(@authcode) != 0)</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" Actionid="NewLine1"></True>
        </Condition>
        <Condition id="22" name="Condition22">
          <Expression>number(@flags) != 4 and number(@type) = 11 and number(@amount) &lt; 0</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">24</True>
        </Condition>
        <Condition id="23" name="Condition23">
          <Expression>number(@flags) != 4 and number(@type) = 11 and number(@amount) &gt; 0</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">28</True>
        </Condition>
        <Condition id="24" name="Condition24">
          <Expression>number(@flags) != 4 and ((number(@type) = 2 or number(@type) = 16) and number(@amount) &lt; 0)</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">14</True>
        </Condition>
        <Condition id="25" name="Condition25">
          <Expression>number(@flags) != 4 and ((number(@type) = 2 or number(@type) = 16) and number(@amount) &gt; 0)</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">26</True>
        </Condition>
        <Condition id="26" name="Condition26">
          <Expression>number(@flags) != 4 and (number(@type) = 7 or number(@type) = 8 or number(@type) = 10 or number(@type) = 14 or number(@type) = 19 or number(@type) = 9 or number(@type) = 20)</Expression>
          <Destination></Destination>
          <True isExpression="true" ExpressionSource="SourceFile" UseDefault="false" ContinueProcessing="True" Actionid="NewLine2"></True>
        </Condition>
        <Condition id="27" name="Condition27">
          <Expression>number(@flags) != 4 and (number(@type) = 7 or number(@type) = 8 or number(@type) = 10 or number(@type) = 14 or number(@type) = 19 or number(@type) = 9 or number(@type) = 20)</Expression>
          <Destination format="{0:g}" type="System.Int64">//L/@Reference_no</Destination>
          <True isExpression="true" ExpressionSource="SourceFile" UseDefault="false" ContinueProcessing="True">string(@account)</True>
        </Condition>
        <Condition id="28" name="Condition28">
          <Expression>number(@flags) != 4 and ((number(@type) = 7 or number(@type) = 8 or number(@type) = 10 or number(@type) = 14 or number(@type) = 19 or number(@type) = 9 or number(@type) = 20) and (number(@amount) &lt; 0 or number(@balance) &lt; 0))</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">27</True>
        </Condition>
        <Condition id="29" name="Condition29">
          <Expression>number(@flags) != 4 and ((number(@type) = 7 or number(@type) = 8 or number(@type) = 10 or number(@type) = 14 or number(@type) = 19 or number(@type) = 9 or number(@type) = 20) and (number(@amount) &gt; 0 or number(@balance) &gt; 0))</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">11</True>
        </Condition>
        <Condition id="30" name="Condition30" GroupName="Layaway forfeit">
          <Expression>number(@flags) != 4 and number(@type) = 13</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">2</True>
        </Condition>
        <Condition id="31" name="Condition31" GroupName="Layaway forfeit" >
          <Expression>number(@flags) != 4 and number(@type) = 13</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True">1433</True>
        </Condition>
        <Condition id="32" name="Condition32">
          <Expression>number(@flags) != 4 and number(@type) = 3</Expression>
          <Destination>//L/@Reference_no</Destination>
          <True isExpression="True" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile">string(@account)</True>
        </Condition>
        <Condition id="33" name="Condition33" GroupName="Gift Card Issues">
          <Expression>number(@flags) != 4 and number(@type) = 18</Expression>
          <Destination format="{0:g}" type="System.Int64">//L/@Reference_no</Destination>
          <True isExpression="True" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile">string(@account)</True>
        </Condition>
        <Condition id="34" name="Condition34" GroupName="Gift Card Issues">
          <Expression>number(@flags) != 4 and number(@type) = 18</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile">630</True>
        </Condition>
        <Condition id="35" name="Condition35" GroupName="Gift Card Issues">
          <Expression>number(@flags) != 4 and number(@type) = 18</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile">26</True>
        </Condition>
        <Condition id="36" name="Condition36" GroupName="Gift Card Redeemed">
          <Expression>number(@flags) != 4 and number(@type) = 17</Expression>
          <Destination format="{0:g}" type="System.Int64">//L/@Reference_no</Destination>
          <True isExpression="True" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile">string(@account)</True>
        </Condition>
        <Condition id="37" name="Condition37" GroupName="Gift Card Redeemed">
          <Expression>number(@flags) != 4 and number(@type) = 17</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile">26</True>
        </Condition>
        <Condition id="38" name="Condition38" GroupName="Gift Card Redeemed">
          <Expression>number(@flags) != 4 and number(@type) = 17 and number(./../L10/@type) = 41</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile">630</True>
        </Condition>
        <Condition id="39" name="Condition39" GroupName="Gift Card Redeemed">
          <Expression>number(@flags) != 4 and number(@type) = 17 and number(./../L10/@type) != 41 and number(@amount) &lt; 0</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile">628</True>
        </Condition>
        <Condition id="40" name="Condition40" GroupName="Gift Card Redeemed">
          <Expression>number(@flags) != 4 and number(@type) = 17 and number(./../L10/@type) != 41 and number(@amount) &lt; 0</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile">24</True>
        </Condition>
        <Condition id="40" name="Condition40" GroupName="Internet PayPal">
          <Expression>number(@flags) != 4 and number(@type) = 99 and (number(@amount) &lt; 0 or number(@balance) &lt; 0)</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile">27</True>
        </Condition>
        <Condition id="40" name="Condition40" GroupName="Internet PayPal">
          <Expression>number(@flags) != 4 and number(@type) = 99 and (number(@amount) &gt; 0 or number(@balance) &gt; 0)</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile">11</True>
        </Condition>
        <Condition id="40" name="Condition40" GroupName="Internet Amazon">
          <Expression>number(@flags) != 4 and number(@type) = 98 and number(@amount) &lt; 0</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile">27</True>
        </Condition>
        <Condition id="40" name="Condition40" GroupName="Internet Amazon">
          <Expression>number(@flags) != 4 and number(@type) = 98 and number(@amount) &gt; 0</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile">11</True>
        </Condition>
        <Condition id="41" name="Condition41" GroupName="Internet">
          <Expression>number(@flags) != 4 and number(@type) = 2107</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile">634</True>
        </Condition>
        <Condition id="42" name="Condition42" GroupName="Internet">
          <Expression>number(@flags) != 4 and number(@type) = 2108</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile">635</True>
        </Condition>
        <Condition id="43" name="Condition43" GroupName="Internet">
          <Expression>number(@flags) != 4 and (number(@type) = 2109 or number(@type) = 2110)</Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile">636</True>
        </Condition>
        <Condition id="44" name="Condition44" GroupName="Internet">
          <Expression>number(@flags) != 4 and (number(@type) = 2107 or number(@type) = 2108 or number(@type) = 2109 or number(@type) = 2110) and number(@amount) &lt; 0</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile">27</True>
        </Condition>
        <Condition id="45" name="Condition45" GroupName="Internet">
          <Expression>number(@flags) != 4 and (number(@type) = 2107 or number(@type) = 2108 or number(@type) = 2109 or number(@type) = 2110) and number(@amount) &gt; 0</Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile">11</True>
        </Condition>
        <Condition id="46" name="Condition46" GroupName="Internet">
          <Expression>number(@flags) != 4 and (number(@type) = 2107 or number(@type) = 2108 or number(@type) = 2109 or number(@type) = 2110)</Expression>
          <Destination format="{0:g}" type="System.Int64">//L/@Reference_no</Destination>
          <True isExpression="True" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile">string(@account)</True>
        </Condition>
        <Condition id="46" name="Condition46" GroupName="Internet PayPal">
          <Expression>number(@flags) != 4 and number(@type) = 99</Expression>
          <Destination>//L/@Reference_no</Destination>
          <True isExpression="True" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile">string(@account)</True>
        </Condition>
        <Condition id="47" name="Condition47" GroupName="Internet">
          <Expression>number(@flags) != 4 and (number(@type) = 2107 or number(@type) = 2108 or number(@type) = 2109 or number(@type) = 2110)</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile" Actionid="NewLine3"></True>
        </Condition>
        <Condition id="48" name="Condition48">
          <Expression>number(@reason) != 0</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile" Actionid="NewLine4"></True>
        </Condition>
        <Condition id="49" name="Condition49">
          <Expression>number(@countnum) != 0</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile" Actionid="NewLine5"></True>
        </Condition>
        <Condition id="50" name="Condition50">
          <Expression>string(@hashed_account) != ''</Expression>
          <Destination></Destination>
          <True isExpression="false" UseDefault="false" ContinueProcessing="True" ExpressionSource="SourceFile" Actionid="NewLine6"></True>
        </Condition>
      </Conditions>
      <Actions>
        <Action>
          <CreateLineItem id="NewLine1" ItemToCreate="//A">
            <Attribute id="Line_id" useIdentity="true" />
            <Attribute id="Authorization_no" isExpression="True" ExpressionSource="SourceFile">string(@authcode)</Attribute>
            <Attribute id="Card_type">B</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine2" ItemToCreate="//A">
            <Attribute id="Line_id" useIdentity="true" />
            <Attribute id="Authorization_no" isExpression="True" ExpressionSource="SourceFile">string(@authcode)</Attribute>
            <Attribute id="Expiry_date_from_POS" isExpression="True" ExpressionSource="SourceFile">string(@expire)</Attribute>
            <!--<Attribute id="Card_type">B</Attribute>-->
            <Conditions>
              <Condition id="1">
                <!--<Expression>number(@flags) = 2</Expression>-->
                <Expression>floor(number(@flags) div 2) mod 2 > 0</Expression>
                <Destination>//A/@Swipe_indicator</Destination>
                <True isExpression="false" UseDefault="false" ContinueProcessing="True">2</True>
                <False isExpression="false" UseDefault="false" ContinueProcessing="True">1</False>
              </Condition>
            </Conditions>
          </CreateLineItem>
          <CreateLineItem id="NewLine3" ItemToCreate="//A">
            <Attribute id="Line_id" useIdentity="true" />
            <Attribute id="Expiry_date_from_POS" isExpression="True" ExpressionSource="SourceFile">string(@expire)</Attribute>
            <Attribute id="Authorization_no" isExpression="True" ExpressionSource="SourceFile">string(@authcode)</Attribute>
            <!--<Attribute id="Card_type">B</Attribute>-->
            <Conditions>
              <Condition id="1">
                <!--<Expression>number(@flags) = 2</Expression>-->
                <Expression>floor(number(@flags) div 2) mod 2 > 0</Expression>
                <Destination>//A/@Swipe_indicator</Destination>
                <True isExpression="false" UseDefault="false" ContinueProcessing="True">2</True>
                <False isExpression="false" UseDefault="false" ContinueProcessing="True">1</False>
              </Condition>
            </Conditions>
          </CreateLineItem>
          <CreateLineItem id="NewLine4" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true" />
            <Attribute id="Line_note_type" isExpression="False" ExpressionSource="SourceFile">28</Attribute>
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(@reason)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine5" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true" />
            <Attribute id="Line_note_type" isExpression="False" ExpressionSource="SourceFile">29</Attribute>
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(@countnum)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine6" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true" />
            <Attribute id="Line_note_type" isExpression="False" ExpressionSource="SourceFile">50</Attribute>
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(@hashed_account)</Attribute>
          </CreateLineItem>
        </Action>
      </Actions>
    </Rule>
    <Rule id="L47" DestinationSavePath="//L" ProcessAsGroup="False" desc="Rules For L47 Value Card Record">
      <Mappings>
        <Mapping id="Mapping1" format="{0:g}" type="System.Decimal">
          <Source>string(@account)</Source>
          <Destination>//L/@Reference_no</Destination>
        </Mapping>
        <Mapping id="Mapping2" format="{0:f}" type="System.Decimal">
          <Source>string(@amount)</Source>
          <Destination>//L/@Line_amount</Destination>
        </Mapping>
      </Mappings>
      <Conditions>
        <Condition id="1" name="Condition1">
          <Expression>number(@type) = 0 </Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">621</True>
        </Condition>
        <Condition id="2" name="Condition2">
          <Expression>number(@type) = 0 </Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">24</True>
        </Condition>
        <Condition id="3" name="Condition3">
          <Expression>number(@type) = 1 </Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">1409</True>
        </Condition>
        <Condition id="4" name="Condition4">
          <Expression>number(@type) = 1 </Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">38</True>
        </Condition>
        <Condition id="5" name="Condition5">
          <Expression>number(@type) = 2 </Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">620</True>
        </Condition>
        <Condition id="6" name="Condition6">
          <Expression>number(@type) = 2 </Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">26</True>
        </Condition>
        <Condition id="7" name="Condition7">
          <Expression>number(@type) = 3 </Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">628</True>
        </Condition>
        <Condition id="8" name="Condition8">
          <Expression>number(@type) = 3 </Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">24</True>
        </Condition>
        <Condition id="9" name="Condition9">
          <Expression>number(@type) = 3 and ./../L10/@type = '89' </Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">629</True>
        </Condition>
        <Condition id="10" name="Condition10">
          <Expression>number(@type) = 3 and ./../L10/@type = '89' </Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">26</True>
        </Condition>
        <Condition id="11" name="Condition11">
          <Expression>number(@type) = 5 </Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">629</True>
        </Condition>
        <Condition id="12" name="Condition12">
          <Expression>number(@type) = 5 </Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">26</True>
        </Condition>
        <Condition id="13" name="Condition13">
          <Expression>number(@type) = 6 </Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">622</True>
        </Condition>
        <Condition id="14" name="Condition14">
          <Expression>number(@type) = 6 </Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">24</True>
        </Condition>
        <Condition id="15" name="Condition15">
          <Expression>number(@type) = 7 </Expression>
          <Destination>//L/@Line_object</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">623</True>
        </Condition>
        <Condition id="16" name="Condition16">
          <Expression>number(@type) = 7 </Expression>
          <Destination>//L/@Line_action</Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True">24</True>
        </Condition>
        <Condition id="17" name="Condition17">
          <Expression>number(@balance) != 0 </Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True" Actionid="NewLine1"></True>
        </Condition>
        <Condition id="18" name="Condition18">
          <Expression>number(1) = 1 </Expression>
          <!--We always need to execute this action so this was the easiest way to do this-->
          <Destination></Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True" Actionid="NewLine2"></True>
        </Condition>
        <Condition id="19" name="Condition19">
          <Expression>number(1) = 1 </Expression>
          <!--We always need to execute this action so this was the easiest way to do this-->
          <Destination></Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True" Actionid="NewLine3"></True>
        </Condition>
        <Condition id="20" name="Condition20">
          <!--<Expression>number(@flags) = 1 </Expression>-->
          <Expression>floor(number(@flags) div 1) mod 2 > 0</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True" Actionid="NewLine4"></True>
        </Condition>
        <Condition id="21" name="Condition21">
          <!--<Expression>number(@flags) = 2 </Expression>-->
          <Expression>floor(number(@flags) div 2) mod 2 > 0</Expression>
          <!--Workaround for xpath not having a bitwise and operator-->
          <Destination></Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True" Actionid="NewLine5"></True>
        </Condition>
        <Condition id="22" name="Condition22">
          <!--<Expression>number(@flags) = 8 </Expression>-->
          <Expression>floor(number(@flags) div 8) mod 2 > 0</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True" Actionid="NewLine6"></True>
        </Condition>
        <Condition id="23" name="Condition23">
          <!--<Expression>number(@flags) = 16 </Expression>-->
          <Expression>floor(number(@flags) div 16) mod 2 > 0</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True" Actionid="NewLine7"></True>
        </Condition>
        <Condition id="24" name="Condition24">
          <!--<Expression>number(@flags) = 32 </Expression>-->
          <Expression>floor(number(@flags) div 32) mod 2 > 0</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True" Actionid="NewLine8"></True>
        </Condition>
        <Condition id="25" name="Condition25">
          <!--<Expression>number(@flags) = 64 </Expression>-->
          <Expression>floor(number(@flags) div 64) mod 2 > 0</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="false" ContinueProcessing="True" Actionid="NewLine9"></True>
        </Condition>
      </Conditions>
      <Actions>
        <Action>
          <CreateLineItem id="NewLine1" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" useIdentity="false" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@balance)</Attribute>
            <Attribute id="Line_note_type" useIdentity="false">31</Attribute>
          </CreateLineItem>
        </Action>
        <Action>
          <CreateLineItem id="NewLine2" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" useIdentity="false" isExpression="True" ExpressionSource="SourceFile">string(@approval)</Attribute>
            <Attribute id="Line_note_type" useIdentity="false">32</Attribute>
          </CreateLineItem>
        </Action>
        <Action>
          <CreateLineItem id="NewLine3" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" useIdentity="false" isExpression="True" ExpressionSource="SourceFile">string(@trace)</Attribute>
            <Attribute id="Line_note_type" useIdentity="false">33</Attribute>
          </CreateLineItem>
        </Action>
        <Action>
          <CreateLineItem id="NewLine4" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" useIdentity="false" isExpression="False" ExpressionSource="SourceFile">Host Credit Was OffLine</Attribute>
            <Attribute id="Line_note_type" useIdentity="false">34</Attribute>
          </CreateLineItem>
        </Action>
        <Action>
          <CreateLineItem id="NewLine5" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" useIdentity="false" isExpression="False" ExpressionSource="SourceFile">Card Swiped</Attribute>
            <Attribute id="Line_note_type" useIdentity="false">35</Attribute>
          </CreateLineItem>
        </Action>
        <Action>
          <CreateLineItem id="NewLine6" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" useIdentity="false" isExpression="False" ExpressionSource="SourceFile">Auth Code Invalid</Attribute>
            <Attribute id="Line_note_type" useIdentity="false">36</Attribute>
          </CreateLineItem>
        </Action>
        <Action>
          <CreateLineItem id="NewLine7" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" useIdentity="false" isExpression="False" ExpressionSource="SourceFile">Void was Approved</Attribute>
            <Attribute id="Line_note_type" useIdentity="false">37</Attribute>
          </CreateLineItem>
        </Action>
        <Action>
          <CreateLineItem id="NewLine8" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" useIdentity="false" isExpression="False" ExpressionSource="SourceFile">Void was not Approved</Attribute>
            <Attribute id="Line_note_type" useIdentity="false">38</Attribute>
          </CreateLineItem>
        </Action>
        <Action>
          <CreateLineItem id="NewLine9" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" useIdentity="false" isExpression="False" ExpressionSource="SourceFile">Void Auth Code Invalid</Attribute>
            <Attribute id="Line_note_type" useIdentity="false">39</Attribute>
          </CreateLineItem>
        </Action>
      </Actions>
    </Rule>
    <Rule id="L51" DestinationSavePath="//L" ProcessAsGroup="False" desc="Rules For L51 Bank Deposit Header">
      <!--<Mappings>
        <Mapping id="Mapping1">
          <Source>number(600)</Source>
          <Destination>//L/@Line_object</Destination>
        </Mapping>
        <Mapping id="Mapping2">
          <Source>number(246)</Source>
          <Destination>//L/@Line_action</Destination> 
        </Mapping>
      </Mappings>-->
      <Conditions>
        <Condition id="1" name="Depositor 1">
          <Expression>string(@depositer1) != ''</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="Depositer1Note"></True>
        </Condition>
        <Condition id="2" name="Depositor 2">
          <Expression>string(@depositer2) != ''</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="Depositer2Note"></True>
        </Condition>
        <Condition id="3" name="deposit_number">
          <Expression>string(@deposit_number) != ''</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="DepositNumberNote"></True>
        </Condition>
        <Condition id="4" name="Deposit_Bag_Number">
          <Expression>string(@deposit_bag_number) != ''</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="DepositBagNumberNote"></True>
        </Condition>
        <Condition id="5" name="Deposit_Type">
          <Expression>string(@Deposit_type) != ''</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="DepositTypeNote"></True>
        </Condition>
        <Condition id="6" name="Over_Short_Reason">
          <Expression>string(@over_short_reason) != ''</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="OverShortReasonNote"></True>
        </Condition>
        <Condition id="7" name="Over Short Comment">
          <Expression>string(@over_short_reason) != '' and (number(following-sibling::L70[1]/@field_type) = 32 and string(following-sibling::L70[1]/@field) != '') </Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="OverShortCommentNote"></True>
        </Condition>
      </Conditions>
      <Actions>
        <Action>
          <CreateLineItem id="Depositer1Note" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(@depositer1)</Attribute>
            <Attribute id="Line_note_type">44</Attribute>
          </CreateLineItem>
          <CreateLineItem id="Depositer2Note" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(@depositer2)</Attribute>
            <Attribute id="Line_note_type">45</Attribute>
          </CreateLineItem>
          <CreateLineItem id="DepositNumberNote" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(@deposit_number)</Attribute>
            <Attribute id="Line_note_type">46</Attribute>
          </CreateLineItem>
          <CreateLineItem id="DepositBagNumberNote" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(@deposit_bag_number)</Attribute>
            <Attribute id="Line_note_type">47</Attribute>
          </CreateLineItem>
          <CreateLineItem id="DepositTypeNote" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(@Deposit_type)</Attribute>
            <Attribute id="Line_note_type">48</Attribute>
          </CreateLineItem>
          <CreateLineItem id="OverShortReasonNote" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(@over_short_reason)</Attribute>
            <Attribute id="Line_note_type">49</Attribute>
          </CreateLineItem>
          <CreateLineItem id="OverShortCommentNote" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(following-sibling::L70[1]/@field)</Attribute>
            <Attribute id="Line_note_type">4</Attribute>
          </CreateLineItem>
        </Action>
      </Actions>
    </Rule>
    <Rule id="L52" DestinationSavePath="//L" ProcessAsGroup="False" desc="Rules For L52 Bank Deposit">
      <Mappings></Mappings>
      <Conditions>
        <Condition id="1" name="Condition1">
          <Expression>number(@tender_id) != 21 and (number(@Tender_id_sub1) = 0 or string(@Tender_id_sub1) = "") </Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLine1"></True>
        </Condition>
      </Conditions>
      <Actions>
        <Action>
          <CreateLineItem id="NewLine1" ItemToCreate="//L">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_action">246</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@extended_amount)</Attribute>
            <Conditions>
              <Condition id="1">
                <Expression>number(@tender_id) = 0</Expression>
                <Destination>//L/@Line_object</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">600</True>
              </Condition>
              <Condition id="2">
                <Expression>number(@tender_id) = 1</Expression>
                <Destination>//L/@Line_object</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">601</True>
              </Condition>
              <Condition id="3">
                <Expression>number(@tender_id) = 2</Expression>
                <Destination>//L/@Line_object</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">602</True>
              </Condition>
              <Condition id="4">
                <Expression>number(@tender_id) = 16</Expression>
                <Destination>//L/@Line_object</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">611</True>
              </Condition>
              <Condition id="5">
                <Expression>number(@tender_id) = 20 or number(@tender_id) = 23</Expression>
                <Destination>//L/@Line_object</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">616</True>
              </Condition>
            </Conditions>
          </CreateLineItem>
        </Action>
      </Actions>
    </Rule>
    <Rule id="L53" DestinationSavePath="//L" ProcessAsGroup="False" desc="Rules For L53 Bank Deposit Verification">
      <Mappings>
        <Mapping id="Mapping1">
          <Source>number(1229)</Source>
          <Destination>//L/@Line_object</Destination>
        </Mapping>
        <Mapping id="Mapping2">
          <Source>number(38)</Source>
          <Destination>//L/@Line_action</Destination>
        </Mapping>
      </Mappings>
      <Conditions>
        <Condition id="1" name="deposit_number">
          <Expression>string(@deposit_number) != ''</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="DepositNumberNote"></True>
        </Condition>
        <Condition id="2" name="Last Name">
          <Expression>string(@last_name) != ''</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="LastNameNote"></True>
        </Condition>
        <Condition id="3" name="Verify Time">
          <Expression>string(@verify_time) != ''</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="VerifyTimeNote"></True>
        </Condition>
        <Condition id="4" name="Reason Code">
          <Expression>string(@reason_code) != ''</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="ReasonCodeNote"></True>
        </Condition>
        <Condition id="5" name="Comments">
          <Expression>string(@comments) != ''</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="CommentsNote"></True>
        </Condition>
        <Condition id="6" name="TimedOut">
          <Expression>string(@timed_out) != ''</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="TimedOutNote"></True>
        </Condition>
      </Conditions>
      <Actions>
        <Action>
          <CreateLineItem id="DepositNumberNote" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(@deposit_number)</Attribute>
            <Attribute id="Line_note_type">46</Attribute>
          </CreateLineItem>
          <CreateLineItem id="LastNameNote" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(@last_name)</Attribute>
            <Attribute id="Line_note_type">51</Attribute>
          </CreateLineItem>
          <CreateLineItem id="VerifyTimeNote" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(@verify_time)</Attribute>
            <Attribute id="Line_note_type">6</Attribute>
          </CreateLineItem>
          <CreateLineItem id="ReasonCodeNote" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(@reason_code)</Attribute>
            <Attribute id="Line_note_type">49</Attribute>
          </CreateLineItem>
          <CreateLineItem id="CommentsNote" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(@comments)</Attribute>
            <Attribute id="Line_note_type">4</Attribute>
          </CreateLineItem>
          <CreateLineItem id="TimedOutNote" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(@timed_out)</Attribute>
            <Attribute id="Line_note_type">48</Attribute>
          </CreateLineItem>
        </Action>
      </Actions>
    </Rule>

    <Rule id="L60" DestinationSavePath="//L" ProcessAsGroup="False" desc="Rules For L60 Totals Logout">
      <Mappings></Mappings>
      <Conditions>
        <Condition id="1" name="Condition1">
          <Expression>number('1') = 1</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLine1"></True>
        </Condition>
      </Conditions>
      <Actions>
        <Action id="NewLine1">
          <CreateLineItem id="NewLine1" ItemToCreate="//L">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_action">38</Attribute>
            <Attribute id="Line_amount" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@amount)</Attribute>
            <!--<Attribute id="Reference_no" isExpression="True" ExpressionSource="SourceFile">number(@countnum)</Attribute>-->
            <Attribute id="Line_object" isExpression="True" ExpressionSource="SourceFile">number(@type)*10000 + ((floor(number(@seq_num) div 4)+1)*100) +(number(@seq_num)-(floor(number(@seq_num) div 4)*4))</Attribute>
            <Conditions>
              <Condition id="0">
                <Expression>number(@countnum) > 0</Expression>
                <Destination>//L/@Reference_no</Destination>
                <True isExpression="True" ExpressionSource="SourceFile" ContinueProcessing="True">number(@countnum)</True>
              </Condition>
              <Condition id="1">
                <Expression>number(@seq_num) = 157 and number(@type) = 2</Expression>
                <Destination>//L/@Line_object</Destination>
                <True isExpression="False" ExpressionSource="SourceFile" ContinueProcessing="True">1819</True>
              </Condition>
              <Condition id="2">
                <Expression>number(@seq_num) = 158 and number(@type) = 2</Expression>
                <Destination>//L/@Line_object</Destination>
                <True isExpression="False" ExpressionSource="SourceFile" ContinueProcessing="True">1820</True>
              </Condition>
              <Condition id="3">
                <Expression>number(@seq_num) = 159 and number(@type) = 2</Expression>
                <Destination>//L/@Line_object</Destination>
                <True isExpression="False" ExpressionSource="SourceFile" ContinueProcessing="True">1821</True>
              </Condition>
              <Condition id="1">
                <Expression>number(@seq_num) = 157 and number(@type) = 1</Expression>
                <Destination>//L/@Line_object</Destination>
                <True isExpression="False" ExpressionSource="SourceFile" ContinueProcessing="True">1813</True>
              </Condition>
              <Condition id="2">
                <Expression>number(@seq_num) = 158 and number(@type) = 1</Expression>
                <Destination>//L/@Line_object</Destination>
                <True isExpression="False" ExpressionSource="SourceFile" ContinueProcessing="True">1814</True>
              </Condition>
              <Condition id="3">
                <Expression>number(@seq_num) = 159 and number(@type) = 1</Expression>
                <Destination>//L/@Line_object</Destination>
                <True isExpression="False" ExpressionSource="SourceFile" ContinueProcessing="True">1815</True>
              </Condition>
            </Conditions>
          </CreateLineItem>
        </Action>
      </Actions>
    </Rule>
    <Rule id="L70" DestinationSavePath="//C" ProcessAsGroup="True"  desc="Rules For L70 Keyboard Entry Info">
      <Mappings></Mappings>
      <Conditions>
        <Condition id="1" name="Condition1">
          <Expression>number(@field_type) != 17 and number(@flags) != 0</Expression>
          <Destination>//C/@Customer_role</Destination>
          <True isExpression="False" ContinueProcessing="True" ExpressionSource="SourceFile">1</True>
        </Condition>
        <Condition id="2" name="Condition2">
          <Expression>string-length(./../L10/@loyalty_number) > 0</Expression>
          <Destination>//C/@Customer_no</Destination>
          <True isExpression="True" ContinueProcessing="True" ExpressionSource="SourceFile">string(./../L10/@loyalty_number)</True>
        </Condition>
        <Condition id="3" name="Condition3">
          <Expression>number(./../L10/@qualify) = 16</Expression>
          <Destination>//C/@Customer_role</Destination>
          <True isExpression="False" ContinueProcessing="True" ExpressionSource="SourceFile">2</True>
        </Condition>
        <Condition id="4" name="Condition4">
          <Expression>number(@field_type) = 17 and number(./../L10/@type) = 148</Expression>
          <Destination></Destination>
          <True isExpression="False" ContinueProcessing="True" Actionid="NewLine2"></True>
        </Condition>
        <Condition id="5" name="Condition5">
          <Expression>number(@field_type) = 1</Expression>
          <Destination>//C/@Last_name</Destination>
          <True isExpression="True" ContinueProcessing="True" ExpressionSource="SourceFile">substring(string(@field),1,19)</True>
        </Condition>
        <Condition id="6" name="Condition6">
          <Expression>number(@field_type) = 2</Expression>
          <Destination>//C/@First_name</Destination>
          <True isExpression="True" ContinueProcessing="True" ExpressionSource="SourceFile">substring(string(@field),1,19)</True>
        </Condition>
        <Condition id="7" name="Condition7">
          <Expression>number(@field_type) = 3</Expression>
          <Destination>//C/@Address_1</Destination>
          <True isExpression="True" ContinueProcessing="True" ExpressionSource="SourceFile">string(@field)</True>
        </Condition>
        <Condition id="8" name="Condition8">
          <Expression>number(@field_type) = 4</Expression>
          <Destination>//C/@Address_2</Destination>
          <True isExpression="True" ContinueProcessing="True" ExpressionSource="SourceFile">string(@field)</True>
        </Condition>
        <Condition id="9" name="Condition9">
          <Expression>number(@field_type) = 5</Expression>
          <Destination>//C/@City</Destination>
          <True isExpression="True" ContinueProcessing="True" ExpressionSource="SourceFile">string(@field)</True>
        </Condition>
        <Condition id="10" name="Condition10">
          <Expression>number(@field_type) = 6</Expression>
          <Destination>//C/@State</Destination>
          <True isExpression="True" ContinueProcessing="True" ExpressionSource="SourceFile">string(@field)</True>
        </Condition>
        <Condition id="11" name="Condition11">
          <Expression>number(@field_type) = 7 and (floor(number(@flags) div 128) mod 2 > 0 or floor(number(@flags) div 32) mod 2 > 0 or floor(number(@flags) div 16) mod 2 > 0)  </Expression>
          <!--Pass the zip code if the record type is Demographics-->
          <Destination>//C/@Postal_code</Destination>
          <True isExpression="True" ContinueProcessing="True" ExpressionSource="SourceFile">substring(string(@field),1,19)</True>
        </Condition>
        <Condition id="11a" name="Condition11">
          <!--Pass the postal code only if the transaction is not a return -->
          <Expression>number(@field_type) = 7 and number(@flags) = 0 and (number(./../L10/@flgs_L10ADMIN) = 0 and (number(./../L10/@type) != 2 and number(./../L10/@type) != 1) )   </Expression>
          <Destination>//C/@Postal_code</Destination>
          <True isExpression="True" ContinueProcessing="True" ExpressionSource="SourceFile">substring(string(@field),1,19)</True>
        </Condition>
        <Condition id="12" name="Condition12">
          <Expression>number(@field_type) = 8</Expression>
          <Destination>//C/@Telephone_no_1</Destination>
          <True isExpression="True" ContinueProcessing="True" ExpressionSource="SourceFile">substring(string(@field),1,15)</True>
        </Condition>
        <Condition id="13" name="Condition13">
          <Expression>number(@field_type) = 15 or number(@field_type) = 99</Expression>
          <Destination>//C/@Telephone_no_2</Destination>
          <True isExpression="True" ContinueProcessing="True" ExpressionSource="SourceFile">substring(string(@field),1,15)</True>
        </Condition>
        <Condition id="14" name="Condition14">
          <Expression>number(@field_type) = 16</Expression>
          <Destination>//C/@Country</Destination>
          <True isExpression="True" ContinueProcessing="True" ExpressionSource="SourceFile">string(@field)</True>
        </Condition>
        <Condition id="15" name="Condition16">
          <Expression>number(@field_type) = 98</Expression>
          <Destination></Destination>
          <True isExpression="False" ContinueProcessing="true" ExpressionSource="SourceFile" Actionid="NewLine3"></True>
        </Condition>    
         <Condition id="15" name="Condition16">
          <Expression>number(@field_type) = 97</Expression>
          <Destination></Destination>
          <True isExpression="False" ContinueProcessing="true" ExpressionSource="SourceFile" Actionid="NewLine4"></True>
        </Condition>    
         <Condition id="15" name="Condition15">
          <Expression>number(@field_type) = 17 and number(@flags) = 0</Expression>
          <Destination>//C/@Telephone_no_1</Destination>
          <True isExpression="False" ContinueProcessing="true" ExpressionSource="SourceFile" Actionid="NewLine1"></True>
        </Condition>
       
      </Conditions>
      <Actions>
        <Action>
          <CreateLineItem id="NewLine1" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="false">0</Attribute>
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(../L70[@field_type='17' and number(@flags) = 0]/@field)</Attribute>
            <Attribute id="Line_note_type">42</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine2" ItemToCreate="//L">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_object" useIdentity="false">1406</Attribute>
            <Attribute id="Line_action" useIdentity="false">38</Attribute>
          </CreateLineItem>
         <CreateLineItem id="NewLine3" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="false">0</Attribute>
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(../L70[@field_type='98']/@field)</Attribute>
            <Attribute id="Line_note_type">129</Attribute>
          </CreateLineItem>
        <CreateLineItem id="NewLine4" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="false">0</Attribute>
            <Attribute id="Line_Note" isExpression="True" ExpressionSource="SourceFile">string(../L70[@field_type='97']/@field)</Attribute>
            <Attribute id="Line_note_type">130</Attribute>
          </CreateLineItem>
        </Action>
      </Actions>
    </Rule>
    <Rule id="L71" DestinationSavePath="//C" ProcessAsGroup="True"  desc="Rules For L71 Keyboard Entry Info">
      <Mappings></Mappings>
      <Conditions>
        <Condition id="1" name="Condition1">
          <Expression>number(./../L10/@type) = 148</Expression>
          <Destination></Destination>
          <True isExpression="False" ContinueProcessing="True" Actionid="NewLine1"></True>
        </Condition>
        <Condition id="2" name="Condition2">
          <Expression>string(@key) = "WILD_PIN"</Expression>
          <Destination>//C/@Customer_no</Destination>
          <True isExpression="True" ContinueProcessing="True" ExpressionSource="SourceFile">substring(string(@value),1,10)</True>
        </Condition>
        <Condition id="3" name="Condition3">
          <Expression>string(@key) = "WILD_TITLE"</Expression>
          <Destination>//C/@Title</Destination>
          <True isExpression="True" ContinueProcessing="True" ExpressionSource="SourceFile">substring(string(@value),1,10)</True>
        </Condition>
        <Condition id="4" name="Condition4">
          <Expression>string(@key) = "WILD_LAST_NAME"</Expression>
          <Destination>//C/@Last_name</Destination>
          <True isExpression="True" ContinueProcessing="True" ExpressionSource="SourceFile">substring(string(@value),1,20)</True>
        </Condition>
        <Condition id="5" name="Condition5">
          <Expression>string(@key) = "WILD_FIRST_NAME"</Expression>
          <Destination>//C/@First_name</Destination>
          <True isExpression="True" ContinueProcessing="True" ExpressionSource="SourceFile">substring(string(@value),1,20)</True>
        </Condition>
        <Condition id="6" name="Condition6">
          <Expression>string(@key) = "WILD_ADDRESS_LINE1"</Expression>
          <Destination>//C/@Address_1</Destination>
          <True isExpression="True" ContinueProcessing="True" ExpressionSource="SourceFile">substring(string(@value),1,40)</True>
        </Condition>
        <Condition id="7" name="Condition7">
          <Expression>string(@key) = "WILD_ADDRESS_LINE2"</Expression>
          <Destination>//C/@Address_2</Destination>
          <True isExpression="True" ContinueProcessing="True" ExpressionSource="SourceFile">substring(string(@value),1,40)</True>
        </Condition>
        <Condition id="8" name="Condition8">
          <Expression>string(@key) = "WILD_CITY"</Expression>
          <Destination>//C/@City</Destination>
          <True isExpression="True" ContinueProcessing="True" ExpressionSource="SourceFile">substring(string(@value),1,40)</True>
        </Condition>
        <Condition id="9" name="Condition9">
          <Expression>string(@key) = "WILD_STATE"</Expression>
          <Destination>//C/@State</Destination>
          <True isExpression="True" ContinueProcessing="True" ExpressionSource="SourceFile">substring(string(@value),1,40)</True>
        </Condition>
        <Condition id="10" name="Condition10">
          <Expression>string(@key) = "WILD_ZIP_CODE"</Expression>
          <Destination>//C/@Postal_code</Destination>
          <True isExpression="True" ContinueProcessing="True" ExpressionSource="SourceFile">substring(string(@value),1,20)</True>
        </Condition>
        <Condition id="11" name="Condition11">
          <Expression>string(@key) = "WILD_PHONE_NUMBER"</Expression>
          <Destination>//C/@Telephone_no_1</Destination>
          <True isExpression="True" ContinueProcessing="True" ExpressionSource="SourceFile">substring(string(@value),1,16)</True>
        </Condition>
        <Condition id="12" name="Condition12">
          <Expression>string(@key) = "WILD_PHONE_NUMBER2"</Expression>
          <Destination>//C/@Telephone_no_2</Destination>
          <True isExpression="True" ContinueProcessing="True" ExpressionSource="SourceFile">substring(string(@value),1,16)</True>
        </Condition>
        <Condition id="13" name="Condition13">
          <Expression>string(@key) = "WILD_COUNTRY"</Expression>
          <Destination>//C/@Country</Destination>
          <True isExpression="True" ContinueProcessing="True" ExpressionSource="SourceFile">substring(string(@value),1,40)</True>
        </Condition>
        <Condition id="14" name="Condition14">
          <Expression>string(@key) = "WILD_EMAIL"</Expression>
          <Destination>//C/@Email_address</Destination>
          <True isExpression="True" ContinueProcessing="True" ExpressionSource="SourceFile">substring(string(@value),1,50)</True>
        </Condition>
      </Conditions>
      <Actions>
        <Action>
          <CreateLineItem id="NewLine1" ItemToCreate="//L">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_object" useIdentity="false">1406</Attribute>
            <Attribute id="Line_action" useIdentity="false">38</Attribute>
          </CreateLineItem>
        </Action>
      </Actions>
    </Rule>
    <Rule id="L90" DestinationSavePath="//L" ProcessAsGroup="False" desc="Rules For L90 Employee Payroll">
      <Mappings></Mappings>
      <Conditions>
        <Condition id="1" >
          <Expression>number(@log_type) = 1 and (number(@hour_bucket) !=0 or number(@hour_bucket) != 5 )</Expression>
          <Destination></Destination>
          <True isExpression="False" ContinueProcessing="True" UseDefault="False" Actionid="NewLine1"></True>
        </Condition>
      </Conditions>
      <Actions>
        <Action>
          <CreateLineItem id="NewLine1" ItemToCreate="//L">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_action" useIdentity="false">38</Attribute>
            <Attribute id="Line_amount" useIdentity="false" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@hour_total)</Attribute>
            <Attribute id="Reference_no" useIdentity="false" isExpression="True" ExpressionSource="SourceFile">substring(number(@ssnum),1,10)</Attribute>
            <Conditions>
              <Condition id="1">
                <Expression>number(@hour_bucket) = 1</Expression>
                <Destination>//L/@Line_object</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False" ExpressionSource="SourceFile">1392</True>
              </Condition>
              <Condition id="2">
                <Expression>number(@hour_bucket) = 2</Expression>
                <Destination>//L/@Line_object</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False" ExpressionSource="SourceFile">1393</True>
              </Condition>
              <Condition id="3">
                <Expression>number(@hour_bucket) = 3</Expression>
                <Destination>//L/@Line_object</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False" ExpressionSource="SourceFile">1395</True>
              </Condition>
              <Condition id="4">
                <Expression>number(@hour_bucket) = 4</Expression>
                <Destination>//L/@Line_object</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False" ExpressionSource="SourceFile">1396</True>
              </Condition>
            </Conditions>
          </CreateLineItem>
        </Action>
      </Actions>
    </Rule>
    <Rule id="L97" DestinationSavePath="//L" ProcessAsGroup="False" desc="Rules For L97 Special Fee/Tax Record">
      <Mappings></Mappings>
      <Conditions>
        <Condition id="1" name="Condition1">
          <Expression>(number(@spec_fee) != 0 and string(@spec_fee) != '') or (string(./../L37/@retspecfee) != '' and number(./../L37/@retspecfee) != 0)</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLine1"></True>
        </Condition>
        <Condition id="2" name="Condition2">
          <Expression>string(@fedtaxamt) != '' and number(@fedtaxamt) != 0 or (number(./../L37/@retgsttax)* -1) > 0 </Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLine2"></True>
        </Condition>
        <Condition id="3" name="Condition3">
          <Expression>string(@hsttaxamt) != '' and number(@hsttaxamt) != 0  or (number(./../L37/@rethsttax)* -1) > 0</Expression>
          <Destination></Destination>
          <True isExpression="False" UseDefault="False" ContinueProcessing="True" Actionid="NewLine3"></True>
        </Condition>
      </Conditions>
      <Actions>
        <Action>
          <CreateLineItem id="NewLine1" ItemToCreate="//L">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_object" useIdentity="False">502</Attribute>
            <!--<Attribute id="Line_amount" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">number(@spec_fee) + (number(./../L37/@retspecfee) * -1)</Attribute>-->
            <Conditions>
              <Condition id="1">
                <Expression>string(./../L37/@retspecfee) = ''</Expression>
                <Destination format="{0:f}" type="System.Decimal">//L/@Line_amount</Destination>
                <True isExpression="True" ExpressionSource="SourceFile" UseDefault="False" ContinueProcessing="True">number(@spec_fee)</True>
                <False isExpression="True" ExpressionSource="SourceFile" UseDefault="False" ContinueProcessing="True">number(@spec_fee) + (number(./../L37/@retspecfee) * -1)</False>
              </Condition>
              <Condition id="1">
                <Expression>number(./../L10/@type) != 1</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">12</True>
              </Condition>
              <Condition id="1">
                <Expression>number(@spec_fee) >= 0 and  count(./../L37/@retspecfee) = 0</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="False">11</True>
              </Condition>
              <Condition id="1">
                <Expression>number(@spec_fee) &lt; 0 and count(./../L37/@retspecfee) = 0</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="False">12</True>
              </Condition>
              <Condition id="1">
                <Expression>number(@spec_fee) + (number(./../L37/@retspecfee) * -1) >= 0</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">11</True>
                <False isExpression="False" UseDefault="False" ContinueProcessing="True">12</False>
              </Condition>
            </Conditions>
          </CreateLineItem>
          <CreateLineItem id="NewLine2" ItemToCreate="//L">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_object" useIdentity="False">501</Attribute>
            <Conditions>
              <Condition>
                <Expression>string(./../L37/@retgsttax) = ''</Expression>
                <Destination format="{0:f}" type="System.Decimal">//L/@Line_amount</Destination>
                <True isExpression="True" ExpressionSource="SourceFile" UseDefault="False" ContinueProcessing="True">number(@fedtaxamt)</True>
                <False isExpression="True" ExpressionSource="SourceFile" UseDefault="False" ContinueProcessing="True">number(@fedtaxamt) + (number(./../L37/@retgsttax) * -1)</False>
              </Condition>
              <Condition id="1">
                <Expression>number(@fedtaxamt) >= 0 and count(./../L37/@retspecfee) = 0</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="False">11</True>
              </Condition>
              <Condition id="1">
                <Expression>number(@fedtaxamt) &lt; 0 and count(./../L37/@retspecfee) = 0</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="False">12</True>
              </Condition>
              <Condition id="1">
                <Expression>number(@fedtaxamt) > 0 +  (number(./../L37/@retspecfee) * -1) >= 0 </Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">11</True>
                <False isExpression="False" UseDefault="False" ContinueProcessing="True">12</False>
              </Condition>
            </Conditions>
          </CreateLineItem>

          <CreateLineItem id="NewLine3" ItemToCreate="//L">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_object" useIdentity="False">506</Attribute>
            <Conditions>
              <Condition>
                <Expression>string(./../L37/@rethsttax) = ''</Expression>
                <Destination format="{0:f}" type="System.Decimal">//L/@Line_amount</Destination>
                <True isExpression="True" ExpressionSource="SourceFile" UseDefault="False" ContinueProcessing="True">number(@hsttaxamt)</True>
                <False isExpression="True" ExpressionSource="SourceFile" UseDefault="False" ContinueProcessing="True">number(@hsttaxamt) + (number(./../L37/@rethsttax) * -1)</False>
              </Condition>
              <Condition id="1">
                <Expression>number(@hsttaxamt) >= 0 and count(./../L37/@retspecfee) = 0</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="False">11</True>
              </Condition>
              <Condition id="1">
                <Expression>number(@hsttaxamt) &lt; 0 and count(./../L37/@retspecfee) = 0</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="False">12</True>
              </Condition>
              <Condition id="1">
                <Expression>number(@hsttaxamt) > 0 +  (number(./../L37/@retspecfee) * -1) >= 0 </Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" UseDefault="False" ContinueProcessing="True">11</True>
                <False isExpression="False" UseDefault="False" ContinueProcessing="True">12</False>
              </Condition>
            </Conditions>
          </CreateLineItem>


        </Action>
      </Actions>
    </Rule>
    <Rule id="L99" DestinationSavePath="//L" ProcessAsGroup="False" desc="Rules For L99 Trailer Record">
      <Mappings></Mappings>
      <Conditions>
        <Condition id="1" name="Condition1" GroupName="Extended Customer">
          <Expression>count(./../L71) > 0</Expression>
          <Destination></Destination>
          <True isExpression="False" ContinueProcessing="True" UseDefault="False" Actionid="NewLine1"></True>
        </Condition>
        <Condition id="2" name="Condition2">
          <Expression>normalize-space(./../L10/@loyalty_number) != "" and count(preceding-sibling::L70) = 0</Expression>
          <Destination></Destination>
          <True isExpression="False" ContinueProcessing="True" UseDefault="False" Actionid="NewLine5"></True>
        </Condition>
        <Condition id="3" name="Condition3">
          <Expression>(floor(number(./../L10/@qualify) div 16) mod 2 > 0) and normalize-space(./../L10/@loyalty_number) != "" </Expression>
          <Destination></Destination>
          <True isExpression="False" ContinueProcessing="True" UseDefault="False" Actionid="NewLine2"></True>
        </Condition>
        <Condition id="4" name="Condition4">
          <Expression>normalize-space(./../L10/@loyalty_number) != ""</Expression>
          <Destination></Destination>
          <True isExpression="False" ContinueProcessing="True" UseDefault="False" Actionid="NewLine3"></True>
        </Condition>
        <!--Wokaround for even exchange-->
        <Condition id="5" name="Condition5">
          <Expression>(string(./../L37/@retspecfee) != '' and number(./../L37/@retspecfee) != 0) and count(preceding-sibling::L97) = 0 </Expression>
          <Destination></Destination>
          <True isExpression="False" ContinueProcessing="True" UseDefault="False" Actionid="NewLine4"></True>
        </Condition>
        <Condition id="6" name="Condition6">
          <Expression>./../L10/@flgs_L10ADMIN ='1' and ./../L10/@type = '1'</Expression>
          <Destination></Destination>
          <True isExpression="False" ContinueProcessing="False" UseDefault="False"></True>
        </Condition>
        <Condition id="7" name="Condition7">
          <Expression>number(@taxes) != 0 or sum(./../L36/@rettax) != 0</Expression>
          <Destination></Destination>
          <True isExpression="False" ContinueProcessing="True" UseDefault="False" Actionid="NewLine7"></True>
        </Condition>
        <Condition id="7" name="Condition8">
          <Expression>(string(@taxes) != '' and number(@taxes) != 0 or sum(./../L36/@rettax) != 0) and string(./../L10/@country) != '1' and floor(number(./../L10/@qualify) div 16) mod 2 > 0</Expression>
          <Destination></Destination>
          <True isExpression="False" ContinueProcessing="True" UseDefault="False" Actionid="NewLine10"></True>
        </Condition>
        <Condition id="8" name="Condition9">
          <Expression>string(@cash) != '' and number(@cash) != 0 and number(./../L10/@reg_num) &lt; 90</Expression>
          <Destination></Destination>
          <True isExpression="False" ContinueProcessing="True" UseDefault="False" Actionid="NewLine6"></True>
        </Condition>
        <Condition id="8" name="Condition9">
          <Expression>number(./../L10/@reg_num) &gt; 90 and number(./../L10/@reg_num) &lt; 100 and string-length(preceding-sibling::L47[1]/@trace) > 0</Expression>
          <Destination></Destination>
          <True isExpression="False" ContinueProcessing="True" UseDefault="False" Actionid="NewLine11"></True>
        </Condition>
        <Condition id="9" name="Condition10">
          <Expression>string(@foreigncurr) != '' and number(@foreigncurr) != 0</Expression>
          <Destination></Destination>
          <True isExpression="False" ContinueProcessing="True" UseDefault="False" Actionid="NewLine8"></True>
        </Condition>
        <Condition id="10" name="Condition11">
          <Expression>string(@foreigncurr) != '' and number(@foreigncurr) != 0 and string(@uscash) != '' and number(@uscash) != 0 and ./../L10/@type != '83'</Expression>
          <Destination></Destination>
          <True isExpression="False" ContinueProcessing="True" UseDefault="False" Actionid="NewLine9"></True>
        </Condition>
      </Conditions>
      <Actions>
        <Action>
          <CreateLineItem id="NewLine1" ItemToCreate="//E">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Customer_role" useIdentity="false">1</Attribute>
            <Attribute id="Customer_info_type" useIdentity="false">5</Attribute>
            <Conditions>
              <Condition id="1">
                <Expression>count(./../L71[@key='WILD_BIRTH_DATE']) >0 or count(./../L71[@key='WILD_GENDER']) >0 or count(./../L71[@key='WILD_MARITAL_STATUS']) >0</Expression>
                <Destination>//E/@Customer_info</Destination>
                <True isExpression="True" ExpressionSource="SourceFile" ContinueProcessing="True" UseDefault="False">
                  concat(substring(string(./../L71[@key='WILD_BIRTH_DATE']/@value),6,2),
                  substring(string(./../L71[@key='WILD_BIRTH_DATE']/@value),9,2),
                  substring(string(./../L71[@key='WILD_BIRTH_DATE']/@value),3,2),
                  substring(string(./../L71[@key='WILD_GENDER']/@value),1,1),
                  substring(string(./../L71[@key='WILD_MARITAL_STATUS']/@value),1,1),
                  concat(substring(string(./../L71[@key='WILD_HEAVY_METAL']/@value),1,1),"N"),
                  string-length(string(./../L71[@key='WILD_HEAVY_METAL']/@value)),
                  concat(substring(string(./../L71[@key='WILD_CLASSIC_ROCK']/@value),1,1),"N"),
                  string-length(string(./../L71[@key='WILD_CLASSIC_ROCK']/@value)),
                  concat(substring(string(./../L71[@key='WILD_ALTERNATIVE']/@value),1,1),"N"),
                  string-length(string(./../L71[@key='WILD_ALTERNATIVE']/@value)),
                  concat(substring(string(./../L71[@key='WILD_DANCE']/@value),1,1),"N"),
                  string-length(string(./../L71[@key='WILD_DANCE']/@value)),
                  concat(substring(string(./../L71[@key='WILD_MOTOWN']/@value),1,1),"N"),
                  string-length(string(./../L71[@key='WILD_MOTOWN']/@value)),
                  concat(substring(string(./../L71[@key='WILD_TOP_40']/@value),1,1),"N"),
                  string-length(string(./../L71[@key='WILD_TOP_40']/@value)),
                  concat(substring(string(./../L71[@key='WILD_HIP_HOP']/@value),1,1),"N"),
                  string-length(string(./../L71[@key='WILD_HIP_HOP']/@value)),
                  concat(substring(string(./../L71[@key='WILD_LATIN']/@value),1,1),"N"),
                  string-length(string(./../L71[@key='WILD_LATIN']/@value)),
                  concat(substring(string(./../L71[@key='WILD_REGGAE']/@value),1,1),"N"),
                  string-length(string(./../L71[@key='WILD_REGGAE']/@value)),
                  concat(substring(string(./../L71[@key='WILD_COUNTRY_MUSIC']/@value),1,1),"N"),
                  string-length(string(./../L71[@key='WILD_COUNTRY_MUSIC']/@value)),
                  concat(substring(string(./../L71[@key='WILD_INSIDE_SCOOP']/@value),1,1),"N"),
                  string-length(string(./../L71[@key='WILD_INSIDE_SCOOP']/@value)),
                  concat(substring(string(./../L71[@key='WILD_ONLINE']/@value),1,1),"N"),
                  string-length(string(./../L71[@key='WILD_ONLINE']/@value))
                  )
                </True>
              </Condition>
            </Conditions>
          </CreateLineItem>
          <CreateLineItem id="NewLine2" ItemToCreate="//C">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Customer_no" useIdentity="false" isExpression="True" ExpressionSource="SourceFile">string(./../L10/@loyalty_number)</Attribute>
            <Attribute id="Customer_role" useIdentity="false" isExpression="false" ExpressionSource="SourceFile">1</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine3" ItemToCreate="//N">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_note_type" useIdentity="False" isExpression="False">16</Attribute>
            <Attribute id="Line_Note" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(./../L10/@loyalty_number)</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine4" ItemToCreate="//L">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_object" useIdentity="False" isExpression="False">502</Attribute>
            <Attribute id="Line_amount" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">number(./../L37/@retspecfee) * -1</Attribute>
            <Conditions>
              <Condition id="1">
                <Expression>string(./../L37/@retspecfee) = '' and string(./../L10/@type) != '1'</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False">11</True>
                <False isExpression="False" ContinueProcessing="True" UseDefault="False">12</False>
              </Condition>
              <Condition id="2">
                <Expression>number(./../L37/@retspecfee)* -1 &gt;= 0 and string(./../L10/@type) != '1'</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False">11</True>
              </Condition>
              <Condition id="3">
                <Expression>number(./../L37/@retspecfee)* -1 &lt; 0 and string(./../L10/@type) != '1'</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False">12</True>
              </Condition>


              <!--<Condition id="1">
                <Expression>//L/@Line_amount &gt;= 0 and string(./../L10/@type) != 1</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False">11</True>
                <False isExpression="False" ContinueProcessing="True" UseDefault="False">12</False>
              </Condition>-->
            </Conditions>
          </CreateLineItem>
          <CreateLineItem id="NewLine5" ItemToCreate="//C">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Customer_no" useIdentity="false" isExpression="True" ExpressionSource="SourceFile">string(./../L10/@loyalty_number)</Attribute>
            <Conditions>
              <Condition id="1">
                <Expression>number(./../L10/@qualify) = 16</Expression>
                <Destination>//C/@Customer_role</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False">2</True>
                <False isExpression="False" ContinueProcessing="True" UseDefault="False">1</False>
              </Condition>
            </Conditions>
          </CreateLineItem>
          <CreateLineItem id="NewLine6" ItemToCreate="//L">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_object" useIdentity="false" isExpression="False" ExpressionSource="SourceFile">600</Attribute>
            <Attribute id="Line_amount" useIdentity="false" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@cash)</Attribute>
            <Conditions>
              <Condition id="1">
                <Expression>number(@cash) &gt;= 0 and string(./../L10/@type) = '83'</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False">32</True>
              </Condition>
              <Condition id="2">
                <Expression>number(@cash) &gt;= 0 and string(./../L10/@type) != '83'</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False">28</True>
              </Condition>
              <Condition id="3">
                <Expression>number(@cash) &lt; 0 and string(./../L10/@type) = '83'</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False">32</True>
              </Condition>
              <Condition id="2">
                <Expression>number(@cash) &lt; 0 and (string(preceding-sibling::L12[1]/@type) = '1' or string(preceding-sibling::L12[1]/@type) = '2' or string(./../L10/@type) = '8')</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False">29</True>
              </Condition>
              <Condition id="2">
                <Expression>number(@cash) &lt; 0 and (string(./../L10/@type) != '83' and string(preceding-sibling::L12[1]/@type) != '1' and string(preceding-sibling::L12[1]/@type) != '2' and string(./../L10/@type) != '8') </Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False">12</True>
              </Condition>
            </Conditions>
          </CreateLineItem>
          <CreateLineItem id="NewLine7" ItemToCreate="//L">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_object" useIdentity="false" isExpression="False">500</Attribute>
            <Attribute id="Line_amount" format="{0:f}" type="System.Double" isExpression="True" ExpressionSource="SourceFile">number(@taxes) + (sum(./../L36/@rettax) * -1) - sum(./../L38[@tax_amount > 0]/@tax_amount)</Attribute>
            <Attribute id="Line_action" isExpression="False" ExpressionSource="SourceFile">11</Attribute>
            <Conditions>
              <Condition id="1">
                <Expression>./../L10/@country = 1</Expression>
                <Destination>//L/@Line_object</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False">503</True>
              </Condition>
              <Condition id="2">
                <Expression>(number(@taxes) + (sum(./../L36/@rettax) * -1)) >= 0</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False">11</True>
                <False isExpression="False" ContinueProcessing="True" UseDefault="False">12</False>
              </Condition>
              <Condition id="2">
                <Expression>./../L10/@flgs_L10ADMIN = 0 and ./../L10/@type = 1</Expression>
                <Destination format="{0:f}" type="System.Double">//L/@Line_amount</Destination>
                <True isExpression="True" ExpressionSource="SourceFile" ContinueProcessing="True" UseDefault="False">number(@taxes) + (sum(./../L36/@rettax) * -1) - sum(./../L38/@tax_amount)</True>
              </Condition>
            </Conditions>
          </CreateLineItem>
          <CreateLineItem id="NewLine8" ItemToCreate="//L">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_object" useIdentity="false" isExpression="False">616</Attribute>
            <Attribute id="Line_amount" format="{0:f}" type="System.Decimal" isExpression="True" ExpressionSource="SourceFile">number(@foreigncurr)</Attribute>
            <Conditions>
              <Condition id="1">
                <Expression>./../L10/@type = '83'</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False">32</True>
              </Condition>
              <Condition id="1">
                <Expression>./../L10/@type != '83'</Expression>
                <Destination>//L/@Line_action</Destination>
                <True isExpression="False" ContinueProcessing="True" UseDefault="False">28</True>
              </Condition>
            </Conditions>
          </CreateLineItem>
          <CreateLineItem id="NewLine9" ItemToCreate="//L">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_object" useIdentity="false" isExpression="False">616</Attribute>
            <Attribute id="Line_amount" format="{0:f}" type="System.Decimal" isExpression="True" ExpressionSource="SourceFile">number(@foreigncurr) - number(@uscash)</Attribute>
            <Attribute id="Line_action" isExpression="False">245</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine10" ItemToCreate="//T">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Exception_tax_jurisdiction" useIdentity="False" isExpression="True" ExpressionSource="SourceFile">string(preceding-sibling::L36/@tax_state)</Attribute>
            <Attribute id="Taxable" isExpression="False" ExpressionSource="SourceFile">1</Attribute>
          </CreateLineItem>
          <CreateLineItem id="NewLine11" ItemToCreate="//L">
            <Attribute id="Line_id" useIdentity="true"></Attribute>
            <Attribute id="Line_object" useIdentity="false" isExpression="True" ExpressionSource="SourceFile">number(substring(preceding-sibling::L47[1]/@trace,0,5))</Attribute>
            <Attribute id="Line_action" useIdentity="false" isExpression="True" ExpressionSource="SourceFile">number(substring(preceding-sibling::L47[1]/@trace,5,3))</Attribute>
            <Attribute id="Line_amount" useIdentity="false" isExpression="True" ExpressionSource="SourceFile" format="{0:f}" type="System.Decimal">number(@cash)</Attribute>
            <Conditions></Conditions>
          </CreateLineItem>
        </Action>
      </Actions>
    </Rule>
  </Rules>
</RuleEngine>